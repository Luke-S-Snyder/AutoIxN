!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).AutomaticInteraction={})}(this,(function(t){"use strict";const e={SELECTION:"selection",ZOOM:"zoom",PAN:"pan",FILTER:"filter",SORT:"sort",BRUSH:"brush",HIGHLIGHT:"highlight",ANNOTATE:"annotate"},n={SVG_CONTAINER:"svg",SVG_GROUP:"g",SVG_TICK:"tick",TICK_DOMAIN:"domain",DEFAULT_ID:"svg_plot",SVG_MARK:["circle","ellipse","line","polygon","polyline","rect","path"]};function i(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function r(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}var a={value:()=>{}};function o(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new s(i)}function s(t){this._=t}function l(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function u(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function c(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=a,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}s.prototype=o.prototype={constructor:s,on:function(t,e){var n,i=this._,r=l(t+"",i),a=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<o;)if(n=(t=r[a]).type)i[n]=c(i[n],t.name,e);else if(null==e)for(n in i)i[n]=c(i[n],t.name,null);return this}for(;++a<o;)if((n=(t=r[a]).type)&&(n=u(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new s(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),a=0;a<n;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(i=this._[t]).length;a<n;++a)i[a].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)}};var f="http://www.w3.org/1999/xhtml",h={svg:"http://www.w3.org/2000/svg",xhtml:f,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function g(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),h.hasOwnProperty(e)?{space:h[e],local:t}:t}function d(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===f&&e.documentElement.namespaceURI===f?e.createElement(t):e.createElementNS(n,t)}}function p(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function _(t){var e=g(t);return(e.local?p:d)(e)}function m(){}function y(t){return null==t?m:function(){return this.querySelector(t)}}function v(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function x(){return[]}function b(t){return null==t?x:function(){return this.querySelectorAll(t)}}function k(t){return function(){return this.matches(t)}}function w(t){return function(e){return e.matches(t)}}var A=Array.prototype.find;function B(){return this.firstElementChild}var C=Array.prototype.filter;function M(){return Array.from(this.children)}function E(t){return new Array(t.length)}function R(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function T(t){return function(){return t}}function L(t,e,n,i,r,a){for(var o,s=0,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],i[s]=o):n[s]=new R(t,a[s]);for(;s<l;++s)(o=e[s])&&(r[s]=o)}function N(t,e,n,i,r,a,o){var s,l,u,c=new Map,f=e.length,h=a.length,g=new Array(f);for(s=0;s<f;++s)(l=e[s])&&(g[s]=u=o.call(l,l.__data__,s,e)+"",c.has(u)?r[s]=l:c.set(u,l));for(s=0;s<h;++s)u=o.call(t,a[s],s,a)+"",(l=c.get(u))?(i[s]=l,l.__data__=a[s],c.delete(u)):n[s]=new R(t,a[s]);for(s=0;s<f;++s)(l=e[s])&&c.get(g[s])===l&&(r[s]=l)}function S(t){return t.__data__}function X(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function z(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function I(t){return function(){this.removeAttribute(t)}}function H(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Y(t,e){return function(){this.setAttribute(t,e)}}function q(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function O(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function P(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function K(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function V(t){return function(){this.style.removeProperty(t)}}function D(t,e,n){return function(){this.style.setProperty(t,e,n)}}function j(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function F(t,e){return t.style.getPropertyValue(e)||K(t).getComputedStyle(t,null).getPropertyValue(e)}function G(t){return function(){delete this[t]}}function U(t,e){return function(){this[t]=e}}function $(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function Z(t){return t.trim().split(/^|\s+/)}function Q(t){return t.classList||new W(t)}function W(t){this._node=t,this._names=Z(t.getAttribute("class")||"")}function J(t,e){for(var n=Q(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function tt(t,e){for(var n=Q(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function et(t){return function(){J(this,t)}}function nt(t){return function(){tt(this,t)}}function it(t,e){return function(){(e.apply(this,arguments)?J:tt)(this,t)}}function rt(){this.textContent=""}function at(t){return function(){this.textContent=t}}function ot(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function st(){this.innerHTML=""}function lt(t){return function(){this.innerHTML=t}}function ut(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function ct(){this.nextSibling&&this.parentNode.appendChild(this)}function ft(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ht(){return null}function gt(){var t=this.parentNode;t&&t.removeChild(this)}function dt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function pt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function _t(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function mt(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,a=e.length;i<a;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function yt(t,e,n){return function(){var i,r=this.__on,a=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),void(i.value=e);this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function vt(t,e,n){var i=K(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function xt(t,e){return function(){return vt(this,t,e)}}function bt(t,e){return function(){return vt(this,t,e.apply(this,arguments))}}R.prototype={constructor:R,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},W.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var kt=[null];function wt(t,e){this._groups=t,this._parents=e}function At(){return new wt([[document.documentElement]],kt)}function Bt(t){return"string"==typeof t?new wt([[document.querySelector(t)]],[document.documentElement]):new wt([[t]],kt)}function Ct(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}wt.prototype=At.prototype={constructor:wt,select:function(t){"function"!=typeof t&&(t=y(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o,s=e[r],l=s.length,u=i[r]=new Array(l),c=0;c<l;++c)(a=s[c])&&(o=t.call(a,a.__data__,c,s))&&("__data__"in a&&(o.__data__=a.__data__),u[c]=o);return new wt(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return v(t.apply(this,arguments))}}(t):b(t);for(var e=this._groups,n=e.length,i=[],r=[],a=0;a<n;++a)for(var o,s=e[a],l=s.length,u=0;u<l;++u)(o=s[u])&&(i.push(t.call(o,o.__data__,u,s)),r.push(o));return new wt(i,r)},selectChild:function(t){return this.select(null==t?B:function(t){return function(){return A.call(this.children,t)}}("function"==typeof t?t:w(t)))},selectChildren:function(t){return this.selectAll(null==t?M:function(t){return function(){return C.call(this.children,t)}}("function"==typeof t?t:w(t)))},filter:function(t){"function"!=typeof t&&(t=k(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o=e[r],s=o.length,l=i[r]=[],u=0;u<s;++u)(a=o[u])&&t.call(a,a.__data__,u,o)&&l.push(a);return new wt(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,S);var n=e?N:L,i=this._parents,r=this._groups;"function"!=typeof t&&(t=T(t));for(var a=r.length,o=new Array(a),s=new Array(a),l=new Array(a),u=0;u<a;++u){var c=i[u],f=r[u],h=f.length,g=X(t.call(c,c&&c.__data__,u,i)),d=g.length,p=s[u]=new Array(d),_=o[u]=new Array(d),m=l[u]=new Array(h);n(c,f,p,_,m,g,e);for(var y,v,x=0,b=0;x<d;++x)if(y=p[x]){for(x>=b&&(b=x+1);!(v=_[b])&&++b<d;);y._next=v||null}}return(o=new wt(o,i))._enter=s,o._exit=l,o},enter:function(){return new wt(this._enter||this._groups.map(E),this._parents)},exit:function(){return new wt(this._exit||this._groups.map(E),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,a=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?a.remove():n(a),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,a=i.length,o=Math.min(r,a),s=new Array(r),l=0;l<o;++l)for(var u,c=n[l],f=i[l],h=c.length,g=s[l]=new Array(h),d=0;d<h;++d)(u=c[d]||f[d])&&(g[d]=u);for(;l<r;++l)s[l]=n[l];return new wt(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],a=r.length-1,o=r[a];--a>=0;)(i=r[a])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=z);for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var o,s=n[a],l=s.length,u=r[a]=new Array(l),c=0;c<l;++c)(o=s[c])&&(u[c]=o);u.sort(e)}return new wt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length;r<a;++r){var o=i[r];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,a=e[n],o=0,s=a.length;o<s;++o)(r=a[o])&&t.call(r,r.__data__,o,a);return this},attr:function(t,e){var n=g(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?H:I:"function"==typeof e?n.local?P:O:n.local?q:Y)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?V:"function"==typeof e?j:D)(t,e,null==n?"":n)):F(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?G:"function"==typeof e?$:U)(t,e)):this.node()[t]},classed:function(t,e){var n=Z(t+"");if(arguments.length<2){for(var i=Q(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?it:e?et:nt)(n,e))},text:function(t){return arguments.length?this.each(null==t?rt:("function"==typeof t?ot:at)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?st:("function"==typeof t?ut:lt)(t)):this.node().innerHTML},raise:function(){return this.each(ct)},lower:function(){return this.each(ft)},append:function(t){var e="function"==typeof t?t:_(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:_(t),i=null==e?ht:"function"==typeof e?e:y(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(gt)},clone:function(t){return this.select(t?pt:dt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,a=_t(t+""),o=a.length;if(!(arguments.length<2)){for(s=e?yt:mt,i=0;i<o;++i)this.each(s(a[i],e,n));return this}var s=this.node().__on;if(s)for(var l,u=0,c=s.length;u<c;++u)for(i=0,l=s[u];i<o;++i)if((r=a[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?bt:xt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],a=0,o=r.length;a<o;++a)(i=r[a])&&(yield i)}};const Mt={capture:!0,passive:!1};function Et(t){t.preventDefault(),t.stopImmediatePropagation()}function Rt(t,e){var n=t.document.documentElement,i=Bt(t).on("dragstart.drag",null);e&&(i.on("click.drag",Et,Mt),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Tt(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Lt(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Nt(){}var St=.7,Xt=1/St,zt="\\s*([+-]?\\d+)\\s*",It="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ht="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Yt=/^#([0-9a-f]{3,8})$/,qt=new RegExp("^rgb\\("+[zt,zt,zt]+"\\)$"),Ot=new RegExp("^rgb\\("+[Ht,Ht,Ht]+"\\)$"),Pt=new RegExp("^rgba\\("+[zt,zt,zt,It]+"\\)$"),Kt=new RegExp("^rgba\\("+[Ht,Ht,Ht,It]+"\\)$"),Vt=new RegExp("^hsl\\("+[It,Ht,Ht]+"\\)$"),Dt=new RegExp("^hsla\\("+[It,Ht,Ht,It]+"\\)$"),jt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ft(){return this.rgb().formatHex()}function Gt(){return this.rgb().formatRgb()}function Ut(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Yt.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?$t(e):3===n?new Jt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Zt(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Zt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=qt.exec(t))?new Jt(e[1],e[2],e[3],1):(e=Ot.exec(t))?new Jt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Pt.exec(t))?Zt(e[1],e[2],e[3],e[4]):(e=Kt.exec(t))?Zt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Vt.exec(t))?ie(e[1],e[2]/100,e[3]/100,1):(e=Dt.exec(t))?ie(e[1],e[2]/100,e[3]/100,e[4]):jt.hasOwnProperty(t)?$t(jt[t]):"transparent"===t?new Jt(NaN,NaN,NaN,0):null}function $t(t){return new Jt(t>>16&255,t>>8&255,255&t,1)}function Zt(t,e,n,i){return i<=0&&(t=e=n=NaN),new Jt(t,e,n,i)}function Qt(t){return t instanceof Nt||(t=Ut(t)),t?new Jt((t=t.rgb()).r,t.g,t.b,t.opacity):new Jt}function Wt(t,e,n,i){return 1===arguments.length?Qt(t):new Jt(t,e,n,null==i?1:i)}function Jt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function te(){return"#"+ne(this.r)+ne(this.g)+ne(this.b)}function ee(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function ne(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function ie(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ae(t,e,n,i)}function re(t){if(t instanceof ae)return new ae(t.h,t.s,t.l,t.opacity);if(t instanceof Nt||(t=Ut(t)),!t)return new ae;if(t instanceof ae)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(o=e===a?(n-i)/s+6*(n<i):n===a?(i-e)/s+2:(e-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new ae(o,s,l,t.opacity)}function ae(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function oe(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Tt(Nt,Ut,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Ft,formatHex:Ft,formatHsl:function(){return re(this).formatHsl()},formatRgb:Gt,toString:Gt}),Tt(Jt,Wt,Lt(Nt,{brighter:function(t){return t=null==t?Xt:Math.pow(Xt,t),new Jt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?St:Math.pow(St,t),new Jt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:te,formatHex:te,formatRgb:ee,toString:ee})),Tt(ae,(function(t,e,n,i){return 1===arguments.length?re(t):new ae(t,e,n,null==i?1:i)}),Lt(Nt,{brighter:function(t){return t=null==t?Xt:Math.pow(Xt,t),new ae(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?St:Math.pow(St,t),new ae(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Jt(oe(t>=240?t-240:t+120,r,i),oe(t,r,i),oe(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var se=t=>()=>t;function le(t){return 1==(t=+t)?ue:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):se(isNaN(e)?n:e)}}function ue(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):se(isNaN(t)?e:t)}var ce=function t(e){var n=le(e);function i(t,e){var i=n((t=Wt(t)).r,(e=Wt(e)).r),r=n(t.g,e.g),a=n(t.b,e.b),o=ue(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=a(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function fe(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var he=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ge=new RegExp(he.source,"g");function de(t,e){var n,i,r,a=he.lastIndex=ge.lastIndex=0,o=-1,s=[],l=[];for(t+="",e+="";(n=he.exec(t))&&(i=ge.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:fe(n,i)})),a=ge.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}var pe,_e=180/Math.PI,me={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ye(t,e,n,i,r,a){var o,s,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*_e,skewX:Math.atan(l)*_e,scaleX:o,scaleY:s}}function ve(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(a,o){var s=[],l=[];return a=t(a),o=t(o),function(t,i,r,a,o,s){if(t!==r||i!==a){var l=o.push("translate(",null,e,null,n);s.push({i:l-4,x:fe(t,r)},{i:l-2,x:fe(i,a)})}else(r||a)&&o.push("translate("+r+e+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(t,e,n,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:n.push(r(n)+"rotate(",null,i)-2,x:fe(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(a.rotate,o.rotate,s,l),function(t,e,n,a){t!==e?a.push({i:n.push(r(n)+"skewX(",null,i)-2,x:fe(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(a.skewX,o.skewX,s,l),function(t,e,n,i,a,o){if(t!==n||e!==i){var s=a.push(r(a)+"scale(",null,",",null,")");o.push({i:s-4,x:fe(t,n)},{i:s-2,x:fe(e,i)})}else 1===n&&1===i||a.push(r(a)+"scale("+n+","+i+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(t){for(var e,n=-1,i=l.length;++n<i;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var xe=ve((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?me:ye(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),be=ve((function(t){return null==t?me:(pe||(pe=document.createElementNS("http://www.w3.org/2000/svg","g")),pe.setAttribute("transform",t),(t=pe.transform.baseVal.consolidate())?ye((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):me)}),", ",")",")");function ke(t){return((t=Math.exp(t))+1/t)/2}var we,Ae,Be=function t(e,n,i){function r(t,r){var a,o,s=t[0],l=t[1],u=t[2],c=r[0],f=r[1],h=r[2],g=c-s,d=f-l,p=g*g+d*d;if(p<1e-12)o=Math.log(h/u)/e,a=function(t){return[s+t*g,l+t*d,u*Math.exp(e*t*o)]};else{var _=Math.sqrt(p),m=(h*h-u*u+i*p)/(2*u*n*_),y=(h*h-u*u-i*p)/(2*h*n*_),v=Math.log(Math.sqrt(m*m+1)-m),x=Math.log(Math.sqrt(y*y+1)-y);o=(x-v)/e,a=function(t){var i,r=t*o,a=ke(v),c=u/(n*_)*(a*(i=e*r+v,((i=Math.exp(2*i))-1)/(i+1))-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[s+c*g,l+c*d,u*a/ke(e*r+v)]}}return a.duration=1e3*o*e/Math.SQRT2,a}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4),Ce=0,Me=0,Ee=0,Re=0,Te=0,Le=0,Ne="object"==typeof performance&&performance.now?performance:Date,Se="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Xe(){return Te||(Se(ze),Te=Ne.now()+Le)}function ze(){Te=0}function Ie(){this._call=this._time=this._next=null}function He(t,e,n){var i=new Ie;return i.restart(t,e,n),i}function Ye(){Te=(Re=Ne.now())+Le,Ce=Me=0;try{!function(){Xe(),++Ce;for(var t,e=we;e;)(t=Te-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ce}()}finally{Ce=0,function(){var t,e,n=we,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:we=e);Ae=t,Oe(i)}(),Te=0}}function qe(){var t=Ne.now(),e=t-Re;e>1e3&&(Le-=e,Re=t)}function Oe(t){Ce||(Me&&(Me=clearTimeout(Me)),t-Te>24?(t<1/0&&(Me=setTimeout(Ye,t-Ne.now()-Le)),Ee&&(Ee=clearInterval(Ee))):(Ee||(Re=Ne.now(),Ee=setInterval(qe,1e3)),Ce=1,Se(Ye)))}function Pe(t,e,n){var i=new Ie;return e=null==e?0:+e,i.restart((n=>{i.stop(),t(n+e)}),e,n),i}Ie.prototype=He.prototype={constructor:Ie,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Xe():+n)+(null==e?0:+e),this._next||Ae===this||(Ae?Ae._next=this:we=this,Ae=this),this._call=t,this._time=n,Oe()},stop:function(){this._call&&(this._call=null,this._time=1/0,Oe())}};var Ke=o("start","end","cancel","interrupt"),Ve=[];function De(t,e,n,i,r,a){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function a(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}function o(a){var u,c,f,h;if(1!==n.state)return l();for(u in r)if((h=r[u]).name===n.name){if(3===h.state)return Pe(o);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete r[u]):+u<e&&(h.state=6,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete r[u])}if(Pe((function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(a))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(f=n.tween.length),u=0,c=-1;u<f;++u)(h=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(i[++c]=h);i.length=c+1}}function s(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),a=-1,o=i.length;++a<o;)i[a].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=He(a,0,n.time)}(t,n,{name:e,index:i,group:r,on:Ke,tween:Ve,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function je(t,e){var n=Ge(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Fe(t,e){var n=Ge(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Ge(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Ue(t,e){var n,i,r,a=t.__transition,o=!0;if(a){for(r in e=null==e?null:e+"",a)(n=a[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete a[r]):o=!1;o&&delete t.__transition}}function $e(t,e){var n,i;return function(){var r=Fe(this,t),a=r.tween;if(a!==n)for(var o=0,s=(i=n=a).length;o<s;++o)if(i[o].name===e){(i=i.slice()).splice(o,1);break}r.tween=i}}function Ze(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var a=Fe(this,t),o=a.tween;if(o!==i){r=(i=o).slice();for(var s={name:e,value:n},l=0,u=r.length;l<u;++l)if(r[l].name===e){r[l]=s;break}l===u&&r.push(s)}a.tween=r}}function Qe(t,e,n){var i=t._id;return t.each((function(){var t=Fe(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Ge(t,i).value[e]}}function We(t,e){var n;return("number"==typeof e?fe:e instanceof Ut?ce:(n=Ut(e))?(e=n,ce):de)(t,e)}function Je(t){return function(){this.removeAttribute(t)}}function tn(t){return function(){this.removeAttributeNS(t.space,t.local)}}function en(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttribute(t);return o===a?null:o===i?r:r=e(i=o,n)}}function nn(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===a?null:o===i?r:r=e(i=o,n)}}function rn(t,e,n){var i,r,a;return function(){var o,s,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(s=l+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,l));this.removeAttribute(t)}}function an(t,e,n){var i,r,a;return function(){var o,s,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,l));this.removeAttributeNS(t.space,t.local)}}function on(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function sn(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ln(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&sn(t,r)),n}return r._value=e,r}function un(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&on(t,r)),n}return r._value=e,r}function cn(t,e){return function(){je(this,t).delay=+e.apply(this,arguments)}}function fn(t,e){return e=+e,function(){je(this,t).delay=e}}function hn(t,e){return function(){Fe(this,t).duration=+e.apply(this,arguments)}}function gn(t,e){return e=+e,function(){Fe(this,t).duration=e}}function dn(t,e){if("function"!=typeof e)throw new Error;return function(){Fe(this,t).ease=e}}function pn(t,e,n){var i,r,a=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?je:Fe;return function(){var o=a(this,t),s=o.on;s!==i&&(r=(i=s).copy()).on(e,n),o.on=r}}var _n=At.prototype.constructor;function mn(t){return function(){this.style.removeProperty(t)}}function yn(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function vn(t,e,n){var i,r;function a(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&yn(t,a,n)),i}return a._value=e,a}function xn(t){return function(e){this.textContent=t.call(this,e)}}function bn(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&xn(i)),e}return i._value=t,i}var kn=0;function wn(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function An(){return++kn}var Bn=At.prototype;wn.prototype={constructor:wn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=y(t));for(var i=this._groups,r=i.length,a=new Array(r),o=0;o<r;++o)for(var s,l,u=i[o],c=u.length,f=a[o]=new Array(c),h=0;h<c;++h)(s=u[h])&&(l=t.call(s,s.__data__,h,u))&&("__data__"in s&&(l.__data__=s.__data__),f[h]=l,De(f[h],e,n,h,f,Ge(s,n)));return new wn(a,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=b(t));for(var i=this._groups,r=i.length,a=[],o=[],s=0;s<r;++s)for(var l,u=i[s],c=u.length,f=0;f<c;++f)if(l=u[f]){for(var h,g=t.call(l,l.__data__,f,u),d=Ge(l,n),p=0,_=g.length;p<_;++p)(h=g[p])&&De(h,e,n,p,g,d);a.push(g),o.push(l)}return new wn(a,o,e,n)},selectChild:Bn.selectChild,selectChildren:Bn.selectChildren,filter:function(t){"function"!=typeof t&&(t=k(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o=e[r],s=o.length,l=i[r]=[],u=0;u<s;++u)(a=o[u])&&t.call(a,a.__data__,u,o)&&l.push(a);return new wn(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var l,u=e[s],c=n[s],f=u.length,h=o[s]=new Array(f),g=0;g<f;++g)(l=u[g]||c[g])&&(h[g]=l);for(;s<i;++s)o[s]=e[s];return new wn(o,this._parents,this._name,this._id)},selection:function(){return new _n(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=An(),i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],l=s.length,u=0;u<l;++u)if(o=s[u]){var c=Ge(o,e);De(o,t,n,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new wn(i,this._parents,t,n)},call:Bn.call,nodes:Bn.nodes,node:Bn.node,size:Bn.size,empty:Bn.empty,each:Bn.each,on:function(t,e){var n=this._id;return arguments.length<2?Ge(this.node(),n).on.on(t):this.each(pn(n,t,e))},attr:function(t,e){var n=g(t),i="transform"===n?be:We;return this.attrTween(t,"function"==typeof e?(n.local?an:rn)(n,i,Qe(this,"attr."+t,e)):null==e?(n.local?tn:Je)(n):(n.local?nn:en)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=g(t);return this.tween(n,(i.local?ln:un)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?xe:We;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var a=F(this,t),o=(this.style.removeProperty(t),F(this,t));return a===o?null:a===n&&o===i?r:r=e(n=a,i=o)}}(t,i)).on("end.style."+t,mn(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,a;return function(){var o=F(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=F(this,t)),o===l?null:o===i&&l===r?a:(r=l,a=e(i=o,s))}}(t,i,Qe(this,"style."+t,e))).each(function(t,e){var n,i,r,a,o="style."+e,s="end."+o;return function(){var l=Fe(this,t),u=l.on,c=null==l.value[o]?a||(a=mn(e)):void 0;u===n&&r===c||(i=(n=u).copy()).on(s,r=c),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,a=n+"";return function(){var o=F(this,t);return o===a?null:o===i?r:r=e(i=o,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,vn(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Qe(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,bn(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=Ge(this.node(),n).tween,a=0,o=r.length;a<o;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((null==e?$e:Ze)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?cn:fn)(e,t)):Ge(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?hn:gn)(e,t)):Ge(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(dn(e,t)):Ge(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Fe(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(a,o){var s={value:o},l={value:function(){0==--r&&a()}};n.each((function(){var n=Fe(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e})),0===r&&a()}))},[Symbol.iterator]:Bn[Symbol.iterator]};var Cn={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Mn(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function En(t){return t}function Rn(t,e,n,i){this.message=t,this.expected=e,this.found=n,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Rn)}At.prototype.interrupt=function(t){return this.each((function(){Ue(this,t)}))},At.prototype.transition=function(t){var e,n;t instanceof wn?(e=t._id,t=t._name):(e=An(),(n=Cn).time=Xe(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],l=s.length,u=0;u<l;++u)(o=s[u])&&De(o,t,e,u,s,n||Mn(o,e));return new wn(i,this._parents,t,e)},function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(Rn,Error),Rn.buildMessage=function(t,e){var n={literal:function(t){return'"'+r(t.text)+'"'},class:function(t){var e,n="";for(e=0;e<t.parts.length;e++)n+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+n+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function i(t){return t.charCodeAt(0).toString(16).toUpperCase()}function r(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}return"Expected "+function(t){var e,i,r,a=new Array(t.length);for(e=0;e<t.length;e++)a[e]=(r=t[e],n[r.type](r));if(a.sort(),a.length>0){for(e=1,i=1;e<a.length;e++)a[e-1]!==a[e]&&(a[i]=a[e],i++);a.length=i}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(t)+" but "+function(t){return t?'"'+r(t)+'"':"end of input"}(e)+" found."};var Tn=function(t,e){e=void 0!==e?e:{};var n,i={},r={svg_path:Q},a=Q,o=function(t,e){return function(t,e){if(!e)return[t];for(var n=[t],i=0,r=e.length;i<r;i++)n[i+1]=e[i][1];return n}(t,e)},s=/^[Mm]/,l=G(["M","m"],!1,!1),u=/^[Zz]/,c=G(["Z","z"],!1,!1),f=/^[Ll]/,h=G(["L","l"],!1,!1),g=function(t,e){return kt(t,e)},d=/^[Hh]/,p=G(["H","h"],!1,!1),_=/^[Vv]/,m=G(["V","v"],!1,!1),y=/^[Cc]/,v=G(["C","c"],!1,!1),x=/^[Ss]/,b=G(["S","s"],!1,!1),k=/^[Qq]/,w=G(["Q","q"],!1,!1),A=/^[Tt]/,B=G(["T","t"],!1,!1),C=/^[Aa]/,M=G(["A","a"],!1,!1),E=/^[01]/,R=G(["0","1"],!1,!1),T=F(",",!1),L=function(t){return t.join("")},N=".",S=F(".",!1),X=/^[eE]/,z=G(["e","E"],!1,!1),I=/^[+\-]/,H=G(["+","-"],!1,!1),Y=/^[0-9]/,q=G([["0","9"]],!1,!1),O=/^[ \t\n\r]/,P=G([" ","\t","\n","\r"],!1,!1),K=0,V=[{line:1,column:1}],D=0,j=[];if("startRule"in e){if(!(e.startRule in r))throw new Error("Can't start parsing from rule \""+e.startRule+'".');a=r[e.startRule]}function F(t,e){return{type:"literal",text:t,ignoreCase:e}}function G(t,e,n){return{type:"class",parts:t,inverted:e,ignoreCase:n}}function U(e){var n,i=V[e];if(i)return i;for(n=e-1;!V[n];)n--;for(i={line:(i=V[n]).line,column:i.column};n<e;)10===t.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return V[e]=i,i}function $(t,e){var n=U(t),i=U(e);return{start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:i.line,column:i.column}}}function Z(t){K<D||(K>D&&(D=K,j=[]),j.push(t))}function Q(){var t,e,n,r,a;for(t=K,e=[],n=_t();n!==i;)e.push(n),n=_t();if(e!==i)if(n=function(){var t,e,n,r,a,s;if(t=K,(e=W())!==i){for(n=[],r=K,a=[],s=_t();s!==i;)a.push(s),s=_t();for(a!==i&&(s=W())!==i?r=a=[a,s]:(K=r,r=i);r!==i;){for(n.push(r),r=K,a=[],s=_t();s!==i;)a.push(s),s=_t();a!==i&&(s=W())!==i?r=a=[a,s]:(K=r,r=i)}n!==i?t=e=o(e,n):(K=t,t=i)}else K=t,t=i;return t}(),n===i&&(n=null),n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(e=function(t){if(!t)return[];for(var e=[],n=0;n<t.length;n++)e=e.concat.apply(e,t[n]);var i=e[0];return i&&"m"==i.code&&(delete i.relative,i.code="M"),e}(n),t=e):(K=t,t=i)}else K=t,t=i;else K=t,t=i;return t}function W(){var e,n,r,a,u,c;if(e=K,n=function(){var e,n,r,a,o,u,c;e=K,s.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(l));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i&&(a=ot())!==i?(o=K,(u=ct())===i&&(u=null),u!==i&&(c=tt())!==i?o=u=[u,c]:(K=o,o=i),o===i&&(o=null),o!==i?(h=o,g=kt(f=n,[a]),h&&(g=g.concat(kt("M"==f?"L":"l",h[1]))),e=n=g):(K=e,e=i)):(K=e,e=i)}else K=e,e=i;var f,h,g;return e}(),n!==i){for(r=[],a=K,u=[],c=_t();c!==i;)u.push(c),c=_t();for(u!==i&&(c=J())!==i?a=u=[u,c]:(K=a,a=i);a!==i;){for(r.push(a),a=K,u=[],c=_t();c!==i;)u.push(c),c=_t();u!==i&&(c=J())!==i?a=u=[u,c]:(K=a,a=i)}r!==i?e=n=o(n,r):(K=e,e=i)}else K=e,e=i;return e}function J(){var e;return(e=function(){var e;K,u.test(t.charAt(K))?(e=t.charAt(K),K++):(e=i,Z(c));e!==i&&(e=kt("Z"));return e}())===i&&(e=function(){var e,n,r,a;e=K,f.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(h));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i&&(a=tt())!==i?e=n=g(n,a):(K=e,e=i)}else K=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=K,d.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(p));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i&&(a=et())!==i?e=n=kt(n,a.map((function(t){return{x:t}}))):(K=e,e=i)}else K=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=K,_.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(m));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i&&(a=et())!==i?e=n=kt(n,a.map((function(t){return{y:t}}))):(K=e,e=i)}else K=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=K,y.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(v));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=K,(e=nt())!==i){for(n=[],r=K,(a=ct())===i&&(a=null),a!==i&&(s=nt())!==i?r=a=[a,s]:(K=r,r=i);r!==i;)n.push(r),r=K,(a=ct())===i&&(a=null),a!==i&&(s=nt())!==i?r=a=[a,s]:(K=r,r=i);n!==i?t=e=o(e,n):(K=t,t=i)}else K=t,t=i;return t}(),a!==i?e=n=g(n,a):(K=e,e=i)):(K=e,e=i)}else K=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=K,x.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(b));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=K,(e=it())!==i){for(n=[],r=K,(a=ct())===i&&(a=null),a!==i&&(s=it())!==i?r=a=[a,s]:(K=r,r=i);r!==i;)n.push(r),r=K,(a=ct())===i&&(a=null),a!==i&&(s=it())!==i?r=a=[a,s]:(K=r,r=i);n!==i?t=e=o(e,n):(K=t,t=i)}else K=t,t=i;return t}(),a!==i?e=n=g(n,a):(K=e,e=i)):(K=e,e=i)}else K=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=K,k.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(w));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=K,(e=rt())!==i){for(n=[],r=K,(a=ct())===i&&(a=null),a!==i&&(s=rt())!==i?r=a=[a,s]:(K=r,r=i);r!==i;)n.push(r),r=K,(a=ct())===i&&(a=null),a!==i&&(s=rt())!==i?r=a=[a,s]:(K=r,r=i);n!==i?t=e=o(e,n):(K=t,t=i)}else K=t,t=i;return t}(),a!==i?e=n=g(n,a):(K=e,e=i)):(K=e,e=i)}else K=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=K,A.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(B));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=K,(e=ot())!==i){for(n=[],r=K,(a=ct())===i&&(a=null),a!==i&&(s=ot())!==i?r=a=[a,s]:(K=r,r=i);r!==i;)n.push(r),r=K,(a=ct())===i&&(a=null),a!==i&&(s=ot())!==i?r=a=[a,s]:(K=r,r=i);n!==i?t=e=o(e,n):(K=t,t=i)}else K=t,t=i;return t}(),a!==i?e=n=g(n,a):(K=e,e=i)):(K=e,e=i)}else K=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=K,C.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(M));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=K,(e=at())!==i){for(n=[],r=K,(a=ct())===i&&(a=null),a!==i&&(s=at())!==i?r=a=[a,s]:(K=r,r=i);r!==i;)n.push(r),r=K,(a=ct())===i&&(a=null),a!==i&&(s=at())!==i?r=a=[a,s]:(K=r,r=i);n!==i?t=e=o(e,n):(K=t,t=i)}else K=t,t=i;return t}(),a!==i?e=n=g(n,a):(K=e,e=i)):(K=e,e=i)}else K=e,e=i;return e}()),e}function tt(){var t,e,n,r,a,s;if(t=K,(e=ot())!==i){for(n=[],r=K,(a=ct())===i&&(a=null),a!==i&&(s=ot())!==i?r=a=[a,s]:(K=r,r=i);r!==i;)n.push(r),r=K,(a=ct())===i&&(a=null),a!==i&&(s=ot())!==i?r=a=[a,s]:(K=r,r=i);n!==i?t=e=o(e,n):(K=t,t=i)}else K=t,t=i;return t}function et(){var t,e,n,r,a,s;if(t=K,(e=lt())!==i){for(n=[],r=K,(a=ct())===i&&(a=null),a!==i&&(s=lt())!==i?r=a=[a,s]:(K=r,r=i);r!==i;)n.push(r),r=K,(a=ct())===i&&(a=null),a!==i&&(s=lt())!==i?r=a=[a,s]:(K=r,r=i);n!==i?t=e=o(e,n):(K=t,t=i)}else K=t,t=i;return t}function nt(){var t,e,n,r,a,o,s,l,u;return t=K,(e=ot())!==i?((n=ct())===i&&(n=null),n!==i&&(r=ot())!==i?((a=ct())===i&&(a=null),a!==i&&(o=ot())!==i?(l=r,u=o,t=e={x1:(s=e).x,y1:s.y,x2:l.x,y2:l.y,x:u.x,y:u.y}):(K=t,t=i)):(K=t,t=i)):(K=t,t=i),t}function it(){var t,e,n,r,a,o;return t=K,(e=ot())!==i?((n=ct())===i&&(n=null),n!==i&&(r=ot())!==i?(o=r,t=e={x2:(a=e).x,y2:a.y,x:o.x,y:o.y}):(K=t,t=i)):(K=t,t=i),t}function rt(){var t,e,n,r,a,o;return t=K,(e=ot())!==i?((n=ct())===i&&(n=null),n!==i&&(r=ot())!==i?(o=r,t=e={x1:(a=e).x,y1:a.y,x:o.x,y:o.y}):(K=t,t=i)):(K=t,t=i),t}function at(){var t,e,n,r,a,o,s,l,u,c,f,h;return t=K,(e=st())!==i?((n=ct())===i&&(n=null),n!==i&&(r=st())!==i?((a=ct())===i&&(a=null),a!==i&&(o=lt())!==i&&ct()!==i&&(s=ut())!==i?((l=ct())===i&&(l=null),l!==i&&(u=ut())!==i?((c=ct())===i&&(c=null),c!==i&&(f=ot())!==i?t=e={rx:e,ry:r,xAxisRotation:o,largeArc:s,sweep:u,x:(h=f).x,y:h.y}:(K=t,t=i)):(K=t,t=i)):(K=t,t=i)):(K=t,t=i)):(K=t,t=i),t}function ot(){var t,e,n,r;return t=K,(e=lt())!==i?((n=ct())===i&&(n=null),n!==i&&(r=lt())!==i?t=e={x:e,y:r}:(K=t,t=i)):(K=t,t=i),t}function st(){var t;return K,(t=ht())===i&&(t=pt()),t!==i&&(t=1*t),t}function lt(){var t,e,n;return K,t=K,(e=dt())===i&&(e=null),e!==i&&(n=ht())!==i?t=e=[e,n]:(K=t,t=i),t===i&&(t=K,(e=dt())===i&&(e=null),e!==i&&(n=pt())!==i?t=e=[e,n]:(K=t,t=i)),t!==i&&(t=1*t.join("")),t}function ut(){var e;return K,E.test(t.charAt(K))?(e=t.charAt(K),K++):(e=i,Z(R)),e!==i&&(e="1"==e),e}function ct(){var t,e,n,r,a;if(t=K,e=[],(n=_t())!==i)for(;n!==i;)e.push(n),n=_t();else e=i;if(e!==i)if((n=ft())===i&&(n=null),n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?t=e=[e,n,r]:(K=t,t=i)}else K=t,t=i;else K=t,t=i;if(t===i){if(t=K,e=K,(n=ft())!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?e=n=[n,r]:(K=e,e=i)}else K=e,e=i;e!==i&&(e=""),t=e}return t}function ft(){var e;return 44===t.charCodeAt(K)?(e=",",K++):(e=i,Z(T)),e}function ht(){var e,n,r;return K,e=K,n=function(){var e,n,r,a;K,e=K,(n=pt())===i&&(n=null);n!==i?(46===t.charCodeAt(K)?(r=N,K++):(r=i,Z(S)),r!==i&&(a=pt())!==i?e=n=[n,r,a]:(K=e,e=i)):(K=e,e=i);e===i&&(e=K,(n=pt())!==i?(46===t.charCodeAt(K)?(r=N,K++):(r=i,Z(S)),r!==i?e=n=[n,r]:(K=e,e=i)):(K=e,e=i));e!==i&&(e=L(e));return e}(),n!==i?((r=gt())===i&&(r=null),r!==i?e=n=[n,r]:(K=e,e=i)):(K=e,e=i),e===i&&(e=K,(n=pt())!==i&&(r=gt())!==i?e=n=[n,r]:(K=e,e=i)),e!==i&&(e=L(e)),e}function gt(){var e,n,r,a;return K,e=K,X.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(z)),n!==i?((r=dt())===i&&(r=null),r!==i&&(a=pt())!==i?e=n=[n,r,a]:(K=e,e=i)):(K=e,e=i),e!==i&&(e=L(e)),e}function dt(){var e;return I.test(t.charAt(K))?(e=t.charAt(K),K++):(e=i,Z(H)),e}function pt(){var e,n;if(K,e=[],Y.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(q)),n!==i)for(;n!==i;)e.push(n),Y.test(t.charAt(K))?(n=t.charAt(K),K++):(n=i,Z(q));else e=i;return e!==i&&(e=e.join("")),e}function _t(){var e;return K,O.test(t.charAt(K))?(e=t.charAt(K),K++):(e=i,Z(P)),e!==i&&(e=""),e}var mt,yt,vt,xt={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var bt in xt)xt[bt.toUpperCase()]=xt[bt];function kt(t,e){e||(e=[{}]);for(var n=e.length;n--;){var i={code:t,command:xt[t]};for(var r in t==t.toLowerCase()&&(i.relative=!0),e[n])i[r]=e[n][r];e[n]=i}return e}if((n=a())!==i&&K===t.length)return n;throw n!==i&&K<t.length&&Z({type:"end"}),mt=j,yt=D<t.length?t.charAt(D):null,vt=D<t.length?$(D,D+1):$(D,D),new Rn(Rn.buildMessage(mt,yt),mt,yt,vt)};Tn.parseSVG=Tn,Tn.makeAbsolute=function(t){var e,n={x:0,y:0},i={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return t.forEach((function(t){for(var r in"moveto"===t.command&&(e=t),t.x0=n.x,t.y0=n.y,i)r in t&&(t[r]+=t.relative?t[i[r]]:0);"x"in t||(t.x=n.x),"y"in t||(t.y=n.y),t.relative=!1,t.code=t.code.toUpperCase(),"closepath"==t.command&&(t.x=e.x,t.y=e.y),n=t})),t};var Ln=Tn;var Nn=t=>()=>t;function Sn(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Xn(t,e,n){this.k=t,this.x=e,this.y=n}Xn.prototype={constructor:Xn,scale:function(t){return 1===t?this:new Xn(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Xn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var zn=new Xn(1,0,0);function In(t){t.stopImmediatePropagation()}function Hn(t){t.preventDefault(),t.stopImmediatePropagation()}function Yn(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function qn(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function On(){return this.__zoom||zn}function Pn(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Kn(){return navigator.maxTouchPoints||"ontouchstart"in this}function Vn(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function Dn(){var t,e,n,i=Yn,r=qn,a=Vn,s=Pn,l=Kn,u=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],f=250,h=Be,g=o("start","zoom","end"),d=500,p=0,_=10;function m(t){t.property("__zoom",On).on("wheel.zoom",A,{passive:!1}).on("mousedown.zoom",B).on("dblclick.zoom",C).filter(l).on("touchstart.zoom",M).on("touchmove.zoom",E).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,e){return(e=Math.max(u[0],Math.min(u[1],e)))===t.k?t:new Xn(e,t.x,t.y)}function v(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new Xn(t.k,i,r)}function x(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function b(t,e,n,i){t.on("start.zoom",(function(){k(this,arguments).event(i).start()})).on("interrupt.zoom end.zoom",(function(){k(this,arguments).event(i).end()})).tween("zoom",(function(){var t=this,a=arguments,o=k(t,a).event(i),s=r.apply(t,a),l=null==n?x(s):"function"==typeof n?n.apply(t,a):n,u=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),c=t.__zoom,f="function"==typeof e?e.apply(t,a):e,g=h(c.invert(l).concat(u/c.k),f.invert(l).concat(u/f.k));return function(t){if(1===t)t=f;else{var e=g(t),n=u/e[2];t=new Xn(n,l[0]-e[0]*n,l[1]-e[1]*n)}o.zoom(null,t)}}))}function k(t,e,n){return!n&&t.__zooming||new w(t,e)}function w(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=r.apply(t,e),this.taps=0}function A(t,...e){if(i.apply(this,arguments)){var n=k(this,e).event(t),r=this.__zoom,o=Math.max(u[0],Math.min(u[1],r.k*Math.pow(2,s.apply(this,arguments)))),l=Ct(t);if(n.wheel)n.mouse[0][0]===l[0]&&n.mouse[0][1]===l[1]||(n.mouse[1]=r.invert(n.mouse[0]=l)),clearTimeout(n.wheel);else{if(r.k===o)return;n.mouse=[l,r.invert(l)],Ue(this),n.start()}Hn(t),n.wheel=setTimeout(f,150),n.zoom("mouse",a(v(y(r,o),n.mouse[0],n.mouse[1]),n.extent,c))}function f(){n.wheel=null,n.end()}}function B(t,...e){if(!n&&i.apply(this,arguments)){var r=t.currentTarget,o=k(this,e,!0).event(t),s=Bt(t.view).on("mousemove.zoom",h,!0).on("mouseup.zoom",g,!0),l=Ct(t,r),u=t.clientX,f=t.clientY;o.mouse=[l,this.__zoom.invert(l)],Ue(this),o.start()}function h(t){if(!o.moved){var e=t.clientX-u,n=t.clientY-f;o.moved=e*e+n*n>p}o.event(t).zoom("mouse",a(v(o.that.__zoom,o.mouse[0]=Ct(t,r),o.mouse[1]),o.extent,c))}function g(t){s.on("mousemove.zoom mouseup.zoom",null),Rt(t.view,o.moved),o.event(t).end()}}function C(t,...e){if(i.apply(this,arguments)){var n=this.__zoom,o=Ct(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(o),l=n.k*(t.shiftKey?.5:2),u=a(v(y(n,l),o,s),r.apply(this,e),c);Hn(t),f>0?Bt(this).transition().duration(f).call(b,u,o,t):Bt(this).call(m.transform,u,o,t)}}function M(n,...r){if(i.apply(this,arguments)){var a,o,s,l,u=n.touches,c=u.length,f=k(this,r,n.changedTouches.length===c).event(n);for(In(n),o=0;o<c;++o)l=[l=Ct(s=u[o],this),this.__zoom.invert(l),s.identifier],f.touch0?f.touch1||f.touch0[2]===l[2]||(f.touch1=l,f.taps=0):(f.touch0=l,a=!0,f.taps=1+!!t);t&&(t=clearTimeout(t)),a&&(f.taps<2&&(e=l[0],t=setTimeout((function(){t=null}),d)),Ue(this),f.start())}}function E(t,...e){if(this.__zooming){var n,i,r,o,s=k(this,e).event(t),l=t.changedTouches,u=l.length;for(Hn(t),n=0;n<u;++n)r=Ct(i=l[n],this),s.touch0&&s.touch0[2]===i.identifier?s.touch0[0]=r:s.touch1&&s.touch1[2]===i.identifier&&(s.touch1[0]=r);if(i=s.that.__zoom,s.touch1){var f=s.touch0[0],h=s.touch0[1],g=s.touch1[0],d=s.touch1[1],p=(p=g[0]-f[0])*p+(p=g[1]-f[1])*p,_=(_=d[0]-h[0])*_+(_=d[1]-h[1])*_;i=y(i,Math.sqrt(p/_)),r=[(f[0]+g[0])/2,(f[1]+g[1])/2],o=[(h[0]+d[0])/2,(h[1]+d[1])/2]}else{if(!s.touch0)return;r=s.touch0[0],o=s.touch0[1]}s.zoom("touch",a(v(i,r,o),s.extent,c))}}function R(t,...i){if(this.__zooming){var r,a,o=k(this,i).event(t),s=t.changedTouches,l=s.length;for(In(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),d),r=0;r<l;++r)a=s[r],o.touch0&&o.touch0[2]===a.identifier?delete o.touch0:o.touch1&&o.touch1[2]===a.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(a=Ct(a,this),Math.hypot(e[0]-a[0],e[1]-a[1])<_)){var u=Bt(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return m.transform=function(t,e,n,i){var r=t.selection?t.selection():t;r.property("__zoom",On),t!==r?b(t,e,n,i):r.interrupt().each((function(){k(this,arguments).event(i).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},m.scaleBy=function(t,e,n,i){m.scaleTo(t,(function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n}),n,i)},m.scaleTo=function(t,e,n,i){m.transform(t,(function(){var t=r.apply(this,arguments),i=this.__zoom,o=null==n?x(t):"function"==typeof n?n.apply(this,arguments):n,s=i.invert(o),l="function"==typeof e?e.apply(this,arguments):e;return a(v(y(i,l),o,s),t,c)}),n,i)},m.translateBy=function(t,e,n,i){m.transform(t,(function(){return a(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)}),null,i)},m.translateTo=function(t,e,n,i,o){m.transform(t,(function(){var t=r.apply(this,arguments),o=this.__zoom,s=null==i?x(t):"function"==typeof i?i.apply(this,arguments):i;return a(zn.translate(s[0],s[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}),i,o)},w.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Bt(this.that).datum();g.call(t,this.that,new Sn(t,{sourceEvent:this.sourceEvent,target:m,type:t,transform:this.that.__zoom,dispatch:g}),e)}},m.wheelDelta=function(t){return arguments.length?(s="function"==typeof t?t:Nn(+t),m):s},m.filter=function(t){return arguments.length?(i="function"==typeof t?t:Nn(!!t),m):i},m.touchable=function(t){return arguments.length?(l="function"==typeof t?t:Nn(!!t),m):l},m.extent=function(t){return arguments.length?(r="function"==typeof t?t:Nn([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):r},m.scaleExtent=function(t){return arguments.length?(u[0]=+t[0],u[1]=+t[1],m):[u[0],u[1]]},m.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(t){return arguments.length?(a=t,m):a},m.duration=function(t){return arguments.length?(f=+t,m):f},m.interpolate=function(t){return arguments.length?(h=t,m):h},m.on=function(){var t=g.on.apply(g,arguments);return t===g?m:t},m.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,m):Math.sqrt(p)},m.tapDistance=function(t){return arguments.length?(_=+t,m):_},m}function jn(t,e,n){var i=d3.select("#"+t.state().svg.id);t.state().x_axis.scale&&!t.state().x_axis.ordinal.length&&t.state().x_axis.axis.scale(t.state().x_axis.scale)(),t.state().y_axis.scale&&!t.state().y_axis.ordinal.length&&t.state().y_axis.axis.scale(t.state().y_axis.scale)(),i.append("defs").append("clipPath").attr("id","clip-"+t.state().svg.id).append("rect").attr("x",t.state().x_axis.range[0]).attr("y",t.state().y_axis.range[1]).attr("width",Math.abs(t.state().x_axis.range[1]-t.state().x_axis.range[0])).attr("height",Math.abs(t.state().y_axis.range[0]-t.state().y_axis.range[1]));const r=i.selectAll('[__mark__="true"]');for(const e of r.nodes()){let n=e.parentElement;"_g_clip"!==n.id&&(n=document.createElementNS("http://www.w3.org/2000/svg","g"),n.id="_g_clip",n.setAttribute("clip-path","url(#clip-"+t.state().svg.id+")"),e.parentElement.appendChild(n)),n.appendChild(e)}var a=r.node()._global_transform[0]+t.state().svg.getBoundingClientRect().left,o=r.node()._global_transform[1]+t.state().svg.getBoundingClientRect().top,s=i.append("g").attr("id","x-axis-zoom-accessor"),l=i.append("g").attr("id","y-axis-zoom-accessor");let u=d3.zoomIdentity;const c=Dn(),f=Dn(),h=()=>d3.zoomTransform(s.node()),g=()=>d3.zoomTransform(l.node());s.call(c).attr("pointer-events","none"),l.call(f).attr("pointer-events","none");i.call(Dn().on("zoom",(function({sourceEvent:e,transform:n}){e.preventDefault(),document.getElementById("modebar").style.visibility="hidden";var d=t.state().interactions.pan.flag,p=t.state().interactions.pan.flag;const _=n.k/u.k,m=(n.x-u.x)/h().k,y=(n.y-u.y)/g().k;if(!t.state().x_axis.axis&&!t.state().y_axis.axis){console.log("here");let a=e.clientX-r.node()._global_transform[0]-t.state().svg.getBoundingClientRect().left,o=e.clientY-r.node()._global_transform[1]-t.state().svg.getBoundingClientRect().top;return 1===_?(d&&s.call(c.translateBy,m,0),p&&l.call(f.translateBy,0,y)):(s.call(c.scaleBy,_,[a,o]),l.call(f.scaleBy,_,[a,o]),t.disambiguate("zoom",!0)),r.attr("transform","translate("+h().x+","+g().y+") scale("+h().k+","+g().k+")"),i.selectAll("text").attr("transform","translate("+h().x+","+g().y+") scale("+h().k+","+g().k+")"),void(u=n)}let v=e.clientX-a>t.state().x_axis.range[0],x=e.clientY-o<t.state().y_axis.range[0],b=e.clientX-r.node()._global_transform[0]-t.state().svg.getBoundingClientRect().left,k=e.clientY-r.node()._global_transform[1]-t.state().svg.getBoundingClientRect().top;1===_?!e.shiftKey&&d&&v&&s.call(c.translateBy,m,0):v&&s.call(c.scaleBy,_,[b,k]),t.state().x_axis.ordinal.length?t.state().x_axis.axis.applyTransform(h())():t.state().x_axis.axis.scale(h().rescaleX(t.state().x_axis.scale))();let w="path"===r.node().nodeName&&"ellipse"===r.node().type&&x,A="path"===r.node().nodeName&&"ellipse"!==r.node().type&&x&&!v,B=t.state().x_axis.scale.domain().length>2&&x&&!v,C=2==t.state().x_axis.scale.domain().length&&"path"!==r.node().nodeName&&x;1===_?!e.shiftKey&&p&&(C||w||A||B)&&l.call(f.translateBy,0,y):(C||w||A||B)&&l.call(f.scaleBy,_,[b,k]),t.state().y_axis.axis.scale(g().rescaleY(t.state().y_axis.scale))();var M=(e.ctrlKey?" ctrl ":"")+(e.shiftKey?" shift ":"")+(e.altKey?" alt ":"");"mousemove"===e.type&&d?document.getElementById("logfile").innerHTML+=e.type+" ["+M+"] "+t.state().svg.id+" to pan ["+(v&&x?"2D":v?"X-AXIS":"Y-AXIS")+"] <br/>":"mousemove"!==e.type&&(document.getElementById("logfile").innerHTML+=e.type+" ["+M+"] "+t.state().svg.id+" to zoom ["+(v&&x?"2D":v?"X-AXIS":"Y-AXIS")+"] <br/>"),r.attr("transform",(function(){let e=this.__transform.match(/(-?\d+\.?-?\d*)/g),n=(this.getBoundingClientRect().left-this._global_transform[0]-t.state().svg.getBoundingClientRect().left+this.getBoundingClientRect().right-this._global_transform[0]-t.state().svg.getBoundingClientRect().left)/2,i=(this.getBoundingClientRect().top-this._global_transform[1]-t.state().svg.getBoundingClientRect().top+this.getBoundingClientRect().bottom-this._global_transform[1]-t.state().svg.getBoundingClientRect().top)/2;this._t||(this._t=[n,i]);let r=0==+e[0]?0:+e[0]-+this._t[0],a=0==+e[1]?0:+e[1]-+this._t[1],o=h().applyX(+this._t[0])+r,s=g().applyY(+this._t[1])+a,l="path"===this.nodeName&&"ellipse"!==this.type,u=t.state().x_axis.scale.domain().length>2;return l||u?"translate("+h().x+","+g().y+") scale("+h().k+","+g().k+")":"translate("+(this.hasAttribute("cx")?o-this.getAttribute("cx"):o)+","+(this.hasAttribute("cy")?s-this.getAttribute("cy"):s)+")"})),r.attr("vector-effect","non-scaling-stroke"),i.selectAll(".hover").attr("display","none");let E=document.querySelectorAll(".tooltip");E.length&&E.forEach((t=>t.style.visibility="hidden")),t.updateBrush(),u=n})))}function Fn(t,e,n){let i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("fill","gray"),i.setAttribute("opacity",.35),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",0),i.setAttribute("height",0),i.setAttribute("id","brush-rect"),i.style.stroke="#fff";let r=t.state().svg;r.appendChild(i);let a=!1,o=[!1,!1];function s(e){if(!t.state().interactions.brush.flag)return;let n=!1;for(const i of t.state().svg_marks){if("line"===i.type||"polygon"===i.type)continue;let t=i.getBoundingClientRect();if(e.clientX>=+t.left&&e.clientX<=+t.right&&e.clientY>=+t.top&&e.clientY<=+t.bottom){n=!0;break}}if(n)return;if(t.disambiguate("brush"),e.clientX-r.getBoundingClientRect().left>=+i.getAttribute("x")&&e.clientX-r.getBoundingClientRect().left<=+i.getAttribute("x")+ +i.getAttribute("width")&&e.clientY-r.getBoundingClientRect().top>=+i.getAttribute("y")&&e.clientY-r.getBoundingClientRect().top<=+i.getAttribute("y")+ +i.getAttribute("height"))return;t.state().interactions.brush.active=!0;var s=t.state().svg_marks[0]._global_transform[0]+t.state().svg.getBoundingClientRect().left,l=t.state().svg_marks[0]._global_transform[1]+t.state().svg.getBoundingClientRect().top;let u=e.clientX-s>t.state().x_axis.range[0],c=e.clientY-l<t.state().y_axis.range[0],f=!u&&c,h=u&&!c||("line"===t.state().svg_marks[0].type||"polygon"===t.state().svg_marks[0].type)&&!f&&t.state().x_axis.ticks.length;o[0]||f?i.setAttribute("width",t.state().x_axis.global_range[1]-t.state().x_axis.global_range[0]):i.setAttribute("width",0),o[1]||h?i.setAttribute("height",t.state().y_axis.global_range[0]-t.state().y_axis.global_range[1]):i.setAttribute("height",0),e.preventDefault(),a=!0,o[0]||f?i.setAttribute("x",t.state().x_axis.global_range[0]):i.setAttribute("x",e.clientX-r.getBoundingClientRect().left),o[1]||h?i.setAttribute("y",t.state().y_axis.global_range[1]):i.setAttribute("y",e.clientY-r.getBoundingClientRect().top);var g=(e.ctrlKey?" ctrl ":"")+(e.shiftKey?" shift ":"")+(e.altKey?" alt ":"");document.getElementById("logfile").innerHTML+=e.type+" ["+g+"] "+t.state().svg.id+" to brush ["+(h||f?h?"X-AXIS":"Y-AXIS":"2D")+"] <br/>"}function l(e){var n=t.state().svg_marks[0]._global_transform[0]+t.state().svg.getBoundingClientRect().left,s=t.state().svg_marks[0]._global_transform[1]+t.state().svg.getBoundingClientRect().top;let l=e.clientX-n>t.state().x_axis.range[0],u=e.clientY-s<t.state().y_axis.range[0],c=!l&&u,f=l&&!u||("line"===t.state().svg_marks[0].type||"polygon"===t.state().svg_marks[0].type)&&!c&&t.state().x_axis.ticks.length;if(a){e.preventDefault();let n=e.clientX-i.getAttribute("x")-r.getBoundingClientRect().left,a=e.clientY-i.getAttribute("y")-r.getBoundingClientRect().top;o[0]||c?i.setAttribute("width",t.state().x_axis.global_range[1]-t.state().x_axis.global_range[0]):i.setAttribute("width",n<0?0:n),o[1]||f?i.setAttribute("height",t.state().y_axis.global_range[0]-t.state().y_axis.global_range[1]):i.setAttribute("height",a<0?0:a),t.filter(+i.getAttribute("x")+ +r.getBoundingClientRect().left,+i.getAttribute("y")+ +r.getBoundingClientRect().top,i.getAttribute("width"),i.getAttribute("height"))}}function u(e){t.state().interactions.brush.active&&(t.state().interactions.brush.active=!1,a=!1,0==+i.getAttribute("width")||0==+i.getAttribute("height")?(t.unfilter(),d3.selectAll(".brush_tooltip").remove(),document.getElementById("logfile").innerHTML+="reset brush <br/>"):(i.setAttribute("width",0),i.setAttribute("height",0)))}r.addEventListener("mousedown",s),r.addEventListener("mousemove",l),r.addEventListener("mouseup",u),e.addEventListener("change",(function(){this.checked||(t.unfilter(),i.setAttribute("width",0),i.setAttribute("height",0)),this.checked?r.addEventListener("mousedown",s):r.removeEventListener("mousedown",s),this.checked?r.addEventListener("mousemove",l):r.removeEventListener("mousemove",l),this.checked?r.addEventListener("mouseup",u):r.removeEventListener("mouseup",u)})),document.querySelectorAll("ul.brush a.axis").forEach((e=>e.addEventListener("click",(function(e){switch(e.target.innerHTML){case"2D":o[0]=o[1]=!1;break;case"X axis":o[0]=!1,o[1]=!0;break;case"Y axis":o[0]=!0,o[1]=!1}0!=+i.getAttribute("width")&&0!=+i.getAttribute("height")&&(o[0]?(i.setAttribute("x",t.state().x_axis.global_range[0]),i.setAttribute("width",t.state().x_axis.global_range[1]-t.state().x_axis.global_range[0])):o[1]&&(i.setAttribute("y",t.state().y_axis.global_range[1]),i.setAttribute("height",t.state().y_axis.global_range[0]-t.state().y_axis.global_range[1])),t.filter(+i.getAttribute("x")+ +r.getBoundingClientRect().left,+i.getAttribute("y")+ +r.getBoundingClientRect().top,i.getAttribute("width"),i.getAttribute("height")))})))),function(t,e,n){var i=0,r=0,a=0,o=0;function s(s){(s=s||window.event).preventDefault(),i=a-s.clientX,r=o-s.clientY,a=s.clientX,o=s.clientY,n[1]||t.setAttribute("y",t.getAttribute("y")-r),n[0]||t.setAttribute("x",t.getAttribute("x")-i),e.filter(+t.getAttribute("x")+ +e.state().svg.getBoundingClientRect().left,+t.getAttribute("y")+ +e.state().svg.getBoundingClientRect().top,t.getAttribute("width"),t.getAttribute("height"))}function l(){t.onmouseup=null,t.onmousemove=null}t.onmousedown=function(e){e=e||window.event,a=e.clientX,o=e.clientY,t.onmouseup=l,t.onmousemove=s}}(i,t,o)}function Gn(t){t.state().x_axis.ordinal.length&&function(t){var e,n,i;function r(r){(r=r||window.event).preventDefault(),r.clientX,r.clientY,r.clientX,r.clientY,e.setAttribute("transform","translate("+(r.clientX-e.__x__)+", 0)");let a=n.label,o=a.hasAttribute("transform")&&a.getAttribute("transform").includes("rotate")?+a.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g).pop():null;a.setAttribute("transform","translate("+(r.clientX-e.__x__)+", 0)"+(o?" rotate("+o+")":""));for(const t of n.ticks)t.setAttribute("transform","translate("+(r.clientX-e.__x__)+", 0)");!function(t){t.state().x_axis.ticks.sort(((t,e)=>+t.label.getBoundingClientRect().left<+e.label.getBoundingClientRect().left?-1:1));let e=t.state().x_axis.ticks.map((t=>t.label.innerHTML));t.state().x_axis.ordinal=e,t.state().x_axis.scale.domain(e)}(t);for(let e=0;e<t.state().x_axis.ticks.length;++e){if(t.state().x_axis.ticks[e].label.innerHTML===n.label.innerHTML)continue;let r=t.state().x_axis.ticks[e],o=(+r.ticks[0].getBoundingClientRect().left+ +r.ticks[0].getBoundingClientRect().right)/2,s=r.label,l=a.hasAttribute("transform")&&s.getAttribute("transform").includes("rotate")?+s.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g).pop():null;s.setAttribute("transform","translate("+(i[e]-o)+", 0)"+(l?" rotate("+l+")":""));for(const n of t.state().x_axis.ticks[e].ticks)n.setAttribute("transform","translate("+(i[e]-o)+", 0)");r.mark.setAttribute("transform","translate("+(i[e]-o)+", 0)")}}function a(){document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)}document.addEventListener("mousedown",(function(o){if("hidden"!==t.state().svg.parentElement.style.visibility){(o=o||window.event).clientX,o.clientY,e=null,n=t.state().x_axis.ticks[0],i=[];for(const n of t.state().svg_marks){if(n.hasAttribute("__legend__"))continue;let t=n.getBoundingClientRect();if(o.clientX>=+t.left&&o.clientX<=+t.right&&o.clientY>=+t.top&&o.clientY<=+t.bottom){e=n;break}}if(e){var s=(o.ctrlKey?" ctrl ":"")+(o.shiftKey?" shift ":"")+(o.altKey?" alt ":"");document.getElementById("logfile").innerHTML+=o.type+" ["+s+"] "+t.state().svg.id+" to sort <br/>",document.addEventListener("mousemove",r),document.addEventListener("mouseup",a),e.__x__=o.clientX,t.state().svg_marks.sort(((t,e)=>{t.getBoundingClientRect().left,e.getBoundingClientRect().left}));let l=(+e.getBoundingClientRect().left+ +e.getBoundingClientRect().right)/2,u=1e3;for(let e=0;e<t.state().x_axis.ticks.length;++e){Math.abs(+t.state().x_axis.ticks[e].ticks[0].getBoundingClientRect().left-l)<u&&(u=Math.abs(+t.state().x_axis.ticks[e].ticks[0].getBoundingClientRect().left-l),n=t.state().x_axis.ticks[e]);let r=t.state().x_axis.ticks[e].ticks[0];i.push((+r.getBoundingClientRect().left+ +r.getBoundingClientRect().right)/2),t.state().x_axis.ticks[e].mark=t.state().svg_marks[e]}n.__x__=o.clientX}}}))}(t)}function Un(){document.querySelector("#tooltip").style.visibility="hidden"}function $n(t,e=null){if(document.querySelector("#"+t))return;const n=document.createElement("div");n.id=t,n.setAttribute("class",e||"tooltip"),n.style="opacity:1; visibility:visible; position:absolute; background-color:white; z-index:999; border:solid; border-width:1px; border-radius:2px; padding:2px; font-size:14px; font-weight:500; pointer-events:none;",document.body.insertBefore(n,null)}function Zn(t,e,n,i,r=null,a=null){if(!r&&d3.selectAll(".brush_tooltip").nodes().length)return;let o=n.getAttribute("transform"),s=1,l=0;if(o){let t=o.match(/(-?\d+\.?\d*)/g);l=+t[0],s=+t[2]}let u,c,f=t.state().x_axis.ticks[0].ticks[0].parentNode._global_transform[0]+t.state().svg.getBoundingClientRect().left,h=e.clientX-f,g=t.state().x_axis.range[0],d=n.getTotalLength();$n("tooltip"+(r||""),a);let p=document.querySelector("#tooltip"+(r||""));for(h<t.state().x_axis.range[0]||t.state().x_axis.range[1]<h?(d3.selectAll(".hover").attr("visibility","hidden"),p&&(p.style.visibility="hidden")):(d3.selectAll(".hover").attr("visibility","visible"),p&&(p.style.visibility="visible")),h=(h-l)/s;u=Math.floor((g+d)/2),c=n.getPointAtLength(u),u!==d&&u!==g||c.x===h;)if(c.x>h)d=u;else{if(!(c.x<h))break;g=u}let _=c.y+t.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1],m=t.state().y_axis.scale.invert(_-t.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1]),y=t.state().x_axis.scale.invert(h);y="number"==typeof y?Math.round(y):function(t){var e=t.getFullYear(),n=(1+t.getMonth()).toString();n=n.length>1?n:"0"+n;var i=t.getDate().toString();return n+"/"+(i=i.length>1?i:"0"+i)+"/"+e}(y);let v="line"===n.type?window.getComputedStyle(n).stroke:window.getComputedStyle(n).fill;p.innerHTML=1===i?1===t.state().svg_marks.length?Math.round(m):"<div><span class='dot' style='background-color:"+v+";'></span><div style='display:inline;margin-right:20px;'> "+(n.__data__.key?n.__data__.key:"")+"</div> <div style='display:inline;float:right;'>"+Math.round(m)+"</div></div>":1===t.state().svg_marks.length?Math.round(m):"<div><span class='dot' style='background-color:"+v+";'></span><div style='display:inline;margin-right:20px;'> "+(n.__data__.key?n.__data__.key:"")+"</div> <div style='display:inline;float:right;'>"+Math.round(m)+"</div></div>"+p.innerHTML,d3.selectAll(".dot").style("height","10px").style("width","10px").style("border-radius","50%").style("display","inline-block"),p.style.color="line"===n.type?window.getComputedStyle(n).stroke:"black",p.style.left=e.pageX+7.5,p.style.top=e.pageY-e.clientY+_+t.state().svg.getBoundingClientRect().top-15;let x=t.state().svg.querySelector("#_circle"+(r||"")+i);x?(x.setAttribute("cx",h*s+l+t.state().x_axis.ticks[0].ticks[0].parentNode._global_transform[0]),x.setAttribute("cy",_),x.setAttribute("display","")):(x=document.createElementNS("http://www.w3.org/2000/svg","circle"),x.setAttribute("r",6),x.setAttribute("fill","line"===n.type?window.getComputedStyle(n).stroke:window.getComputedStyle(n).fill),x.setAttribute("opacity",.75),x.setAttribute("stroke","black"),x.setAttribute("stroke-width","1px"),x.id="_circle"+(r||"")+i,x.setAttribute("class",a||"hover"),t.state().svg.append(x),x.setAttribute("cx",h*s+l+t.state().x_axis.ticks[0].ticks[0].parentNode._global_transform[0]),x.setAttribute("cy",_));let b=t.state().svg.querySelector("#_hoverline"+(r||""));b?(b.setAttribute("x1",e.clientX-t.state().svg.getBoundingClientRect().left),b.setAttribute("x2",e.clientX-t.state().svg.getBoundingClientRect().left),b.setAttribute("display","")):(b=document.createElementNS("http://www.w3.org/2000/svg","line"),b.setAttribute("stroke","black"),b.setAttribute("stroke-width",1.5),b.setAttribute("opacity","0.5"),b.style["pointer-events"]="none",b.setAttribute("class",a||"hover"),b.setAttribute("y1",t.state().y_axis.range[0]+t.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1]),b.setAttribute("y2",t.state().y_axis.range[1]+t.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1]),b.setAttribute("x1",e.clientX-t.state().svg.getBoundingClientRect().left),b.setAttribute("x2",e.clientX-t.state().svg.getBoundingClientRect().left),b.id="_hoverline"+(r||""),t.state().svg.append(b))}function Qn(t,e){!function(t,e){function n(e){if(t.state().interactions.selection.active=!0,e.target.hasAttribute("__legend__")){let i=window.getComputedStyle(e.target).fill;for(const e of t.state().svg_marks)window.getComputedStyle(e).fill!=i?e.setAttribute("opacity",.25):e.setAttribute("opacity",1);var n=(e.ctrlKey?" ctrl ":"")+(e.shiftKey?" shift ":"")+(e.altKey?" alt ":"");return void(document.getElementById("logfile").innerHTML+=e.type+" ["+n+"] "+t.state().svg.id+" to filter by legend <br/>")}document.getElementById("filter_mode").style.opacity=1,document.getElementById("filter_mode").style.display="block";let i=e.ctrlKey,r=e.metaKey,a=e.altKey,o=e.shiftKey;if(i||r||a||o){let t=e.target.hasAttribute("opacity")?1==+e.target.getAttribute("opacity")?.25:1:.25;e.target.setAttribute("opacity",t)}else{e.target.setAttribute("opacity",1);for(const n of t.state().svg_marks)n!==e.target&&n.setAttribute("opacity",.25)}n=(e.ctrlKey?" ctrl ":"")+(e.shiftKey?" shift ":"")+(e.altKey?" alt ":""),document.getElementById("logfile").innerHTML+=e.type+" ["+n+"] "+t.state().svg.id+" to select mark <br/>"}function i(t){$n("tooltip");let e=document.querySelector("#tooltip"),n="",i=t.target;if(i.__inferred__data__){for(const[t,e]of Object.entries(i.__inferred__data__))n+=String(t)+": "+String(e),n+="<br/>";e.innerHTML=n,e.style.visibility="visible",e.style.left=t.pageX+7,e.style.top=t.pageY}}function r(e){const n=t.state().svg_marks;var i=0;for(const r of n)++i,Zn(t,e,r,i);if(n.length>1){let t=document.getElementById("tooltip");[...t.children].sort(((t,e)=>+t.children[2].innerHTML<+e.children[2].innerText?1:-1)).forEach((e=>t.appendChild(e)));for(let e=0;e<t.children.length-1;++e)t.children[e].children[2].innerHTML=+t.children[e].children[2].innerHTML-+t.children[e+1].children[2].innerHTML}}for(const e of t.state().svg_marks)e.type&&"ellipse"!==e.type&&(t.state().x_axis.ticks.length||t.state().y_axis.ticks.length)?t.state().svg.addEventListener("mousemove",r):(e.addEventListener("mouseenter",i),e.addEventListener("mouseleave",Un),e.style.cursor="pointer"),e.addEventListener("click",n);e.addEventListener("change",(function(){if(!this.checked){d3.select("#"+t.state().svg.id).selectAll(".hover").attr("display","none");let e=document.querySelectorAll(".tooltip");e.length&&e.forEach((t=>t.style.visibility="hidden"))}for(const e of t.state().svg_marks)e.type&&"ellipse"!==e.type&&(t.state().x_axis.ticks.length||t.state().y_axis.ticks.length)?this.checked?t.state().svg.addEventListener("mousemove",r):t.state().svg.removeEventListener("mousemove",r):(this.checked?e.addEventListener("mouseenter",i):e.removeEventListener("mouseenter",i),this.checked?e.addEventListener("mouseleave",Un):e.removeEventListener("mouseleave",Un))}))}(t,e)}Qn.applyBrush=function(t,e,n,i,r){d3.selectAll(".brush_tooltip").remove();let a={clientX:e,pageX:e,clientY:n,pageY:n},o={clientX:e+ +i,pageX:e+ +i,clientY:n+ +r,pageY:n+ +r},s=0;for(const e of t.state().svg_marks)++s,Zn(t,a,e,s,"brush1","brush_tooltip"),Zn(t,o,e,s,"brush2","brush_tooltip");if(t.state().svg_marks.length>1){let t=[document.getElementById("tooltipbrush1"),document.getElementById("tooltipbrush2")];for(const e of t){[...e.children].sort(((t,e)=>+t.children[2].innerHTML<+e.children[2].innerText?1:-1)).forEach((t=>e.appendChild(t)));for(let t=0;t<e.children.length-1;++t)e.children[t].children[2].innerHTML=+e.children[t].children[2].innerHTML-+e.children[t+1].children[2].innerHTML}}},Qn.updateBrush=function(t){if(!document.getElementById("_hoverlinebrush1"))return;let e=document.getElementById("_hoverlinebrush1").getBoundingClientRect().left,n=document.getElementById("_hoverlinebrush1").getBoundingClientRect().top,i=document.getElementById("_hoverlinebrush2").getBoundingClientRect().left,r=document.getElementById("_hoverlinebrush2").getBoundingClientRect().top,a={clientX:e,pageX:e,clientY:n,pageY:n},o={clientX:i,pageX:i,clientY:r,pageY:r},s=0;for(const e of t.state().svg_marks)++s,Zn(t,a,e,s,"brush1","brush_tooltip"),Zn(t,o,e,s,"brush2","brush_tooltip");if(t.state().svg_marks.length>1){let t=[document.getElementById("tooltipbrush1"),document.getElementById("tooltipbrush2")];for(const e of t){[...e.children].sort(((t,e)=>+t.children[2].innerHTML<+e.children[2].innerText?1:-1)).forEach((t=>e.appendChild(t)));for(let t=0;t<e.children.length-1;++t)e.children[t].children[2].innerHTML=+e.children[t].children[2].innerHTML-+e.children[t+1].children[2].innerHTML}}};function Wn(t,e){return"translate("+t+","+e+")"}function Jn(t,e){return"translate("+e+","+t+")"}function ti(t){return e=>+t(e)}function ei(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function ni(t,e,n){var i=[],r=null,a=null,o=6,s=6,l=3,u="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=1===t||3===t?Wn:Jn,f=null,h=1===t||3===t?0:1,g=null,d=1===t||3===t?n.state().x_axis:n.state().y_axis,p=d.ticks;function _(){var o=null==r?e.ticks?e.ticks.apply(e,i):e.domain():r,s=null==a?e.tickFormat?e.tickFormat.apply(e,i):En:a,l=(e.bandwidth?ei:ti)(e.copy(),u);function _(t,e){const i=t.getBoundingClientRect().right-t.parentElement._global_transform[0]-n.state().svg.getBoundingClientRect().left;t._t||(t._t=[i,t.hasAttribute("transform")?+t.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[0]:i]);let r=e.applyX(t._t[0]);return r<d.range[0]||r>d.range[1]?t.style.display="none":t.style.display="block",r-t._t[0]+t._t[1]}function m(e,n){let i=e.label,r=e.ticks;i.innerHTML=d.ordinal.length||i.innerHTML==s(n)?i.innerHTML:s(n);let a=i.hasAttribute("transform")?1===t||3===t?i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[1]:i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[0]:0,o=i.hasAttribute("transform")?1===t||3===t?i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[0]:i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[1]:1===t||3===t?i._global_transform[0]:i._global_transform[1];if(f=null==f?+o-l(n):f,g)var u=c(_(i,g),+Math.abs(a)>.01?+a:0);else u=c(l(n)+(Math.abs(f)<5?f:0)+d.global_range[h]-i._global_transform[h],+Math.abs(a)>.01?+a:0);let p=i.hasAttribute("transform")&&i.getAttribute("transform").includes("rotate")?+i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g).pop():null;i.setAttribute("transform",u+(p?" rotate("+p+")":""));for(const e of r){let r=e.hasAttribute("transform")?1===t||3===t?e.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[1]:e.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[0]:0;if(g)var m=c(_(i,g),+Math.abs(a)>.01?+a:0);else m=c(l(n)+d.global_range[h]-i._global_transform[h],+Math.abs(r)>.01?+r:0);e.setAttribute("transform",m)}}o=4===t||2===t?o.reverse():o;for(var y=0;y<o.length&&y<p.length;++y)m(p[y],d.ordinal.length?d.ordinal[y]:o[y]);for(;y<o.length;++y){let t={label:p[0].label.cloneNode(),ticks:p[0].ticks.map((t=>{let e=t.cloneNode();return e._global_transform=t._global_transform,e})),offset:null};t.label._global_transform=p[0].label._global_transform,m(t,o[y]),p[0].label.parentElement.appendChild(t.label),p[0].ticks.forEach(((e,n)=>e.parentElement.appendChild(t.ticks[n]))),p.push(t)}let v=p.length;for(let t=0;y<v;++y){let e=p.length-1-t;p[e].label.remove(),p[e].ticks.forEach((t=>t.remove())),p.pop()}}return _.applyTransform=function(t){return arguments.length?(g=t,_):_},_.scale=function(t){return arguments.length?(e=t,_):e},_.ticks=function(){return i=Array.from(arguments),_},_.tickArguments=function(t){return arguments.length?(i=null==t?[]:Array.from(t),_):i.slice()},_.tickValues=function(t){return arguments.length?(r=null==t?null:Array.from(t),_):r&&r.slice()},_.tickFormat=function(t){return arguments.length?(a=t,_):a},_.tickSize=function(t){return arguments.length?(o=s=+t,_):o},_.tickSizeInner=function(t){return arguments.length?(o=+t,_):o},_.tickSizeOuter=function(t){return arguments.length?(s=+t,_):s},_.tickPadding=function(t){return arguments.length?(l=+t,_):l},_.offset=function(t){return arguments.length?(u=+t,_):u},_}function ii(t,e){return ni(3,t,e)}function ri(t){ai(t)}let ai=function(t){document.addEventListener("mouseup",(function(e){if(!t.state().interactions.annotate.flag)return;let n=e.clientX-t.state().svg.getBoundingClientRect().left,i=e.clientY-t.state().svg.getBoundingClientRect().top;if(n<t.state().x_axis.range[0]||i<t.state().y_axis.range[1])return;let r=prompt("Type here");if(!r)return;const a=[{note:{label:r},x:e.clientX-t.state().svg.getBoundingClientRect().left,y:e.clientY-t.state().svg.getBoundingClientRect().top,dy:20,dx:20,connector:{end:"dot"}}],o=d3.annotation().type(d3.annotationLabel).annotations(a);d3.select("#"+t.state().svg.id).append("g").attr("class","annotation-group").call(o);var s=(e.ctrlKey?" ctrl ":"")+(e.shiftKey?" shift ":"")+(e.altKey?" alt ":"");document.getElementById("logfile").innerHTML+=e.type+" ["+s+"] "+t.state().svg.id+" to annotate <br/>"}))};function oi(){var t={has_domain:!1,svg:null,svg_marks:[],text_marks:[],axis_text_marks:[],x_axis:{domain:[null,null],ordinal:[],range:[null,null],global_range:[null,null],ticks:[],scale:null,axis:null},y_axis:{domain:[null,null],ordinal:[],range:[null,null],global_range:[null,null],ticks:[],scale:null,axis:null},legend:[],titles:{x:null,y:null},interactions:{selection:{control:null,active:!1},zoom:{control:null,axis_control:null},pan:{control:null,axis_control:null,flag:!1},brush:{control:null,axis_control:null,flag:!0,active:!1},filter:{control:null,active:!1},sort:{control:null},annotate:{flag:!1}}},n=function(t,e){let n={};for(let i=0;i<t.ticks.length;++i){let r=t.ticks[i].getBoundingClientRect()[e];t.ticks[i].setAttribute("class",("left"===e?"x-axis":"y-axis")+" tick"),r in n?n[r].ticks.push(t.ticks[i]):n[r]={label:null,ticks:[t.ticks[i]]}}t.ticks=[];for(const[e,i]of Object.entries(n))i.offset=+e,t.ticks.push(i);t.ticks.sort(((t,e)=>+t.offset<+e.offset?-1:+t.offset>+e.offset?1:0))},a=function(t){for(const[e,n]of Object.entries(t.ticks)){let e=n.label.__data__||0==+n.label.__data__?n.label.__data__:isNaN(parseInt(n.label.innerHTML))?n.label.innerHTML:+n.label.innerHTML.replace(/,/g,"");"string"==typeof e?t.ordinal.push(e):(t.domain[0]=null===t.domain[0]?e:r([t.domain[0],e]),t.domain[1]=null===t.domain[1]?e:i([t.domain[1],e]))}};function o(){}return o.hydrate=function(){for(const[n,i]of Object.entries(t.interactions))switch(n){case e.SELECTION:Qn(o,i.control);break;case e.ZOOM:jn(o,i.control,i.axis_control);break;case e.PAN:break;case e.BRUSH:t.svg.style.cursor="crosshair",Fn(o,i.control,i.axis_control);break;case e.FILTER:i.control;break;case e.SORT:Gn(o);break;case e.ANNOTATE:ri(o)}let n=!1;t.svg.addEventListener("mousedown",(function(t){n=!0})),t.svg.addEventListener("mouseup",(function(t){n=!1})),t.svg.addEventListener("mousemove",(function(e){if(n||(document.getElementById("modebar").style.visibility="visible"),t.interactions.pan.flag){let n=t.svg_marks[0]._global_transform[0]+o.state().svg.getBoundingClientRect().left,i=t.svg_marks[0]._global_transform[1]+o.state().svg.getBoundingClientRect().top,r=e.clientX-n>t.x_axis.range[0],a=e.clientY-i<t.y_axis.range[0];t.svg.style.cursor=r&&!a?"ew-resize":!r&&a?"ns-resize":"move"}})),t.svg.addEventListener("mouseleave",(function(e){(e.clientX<=+t.svg.getBoundingClientRect().left||e.clientX>=+t.svg.getBoundingClientRect().right)&&(document.getElementById("modebar").style.visibility="hidden")}));let i=document.getElementById("pan_mode"),r=document.getElementById("brush_mode"),a=document.getElementById("filter_mode"),s=document.getElementById("annotate_mode");i.addEventListener("click",(function(e){"hidden"!==t.svg.parentNode.style.visibility&&(i.style.opacity=.4==+i.style.opacity?1:.4,r.style.opacity=.4,s.style.opacity=.4,t.interactions.pan.flag=!t.interactions.pan.flag,t.interactions.brush.flag=!1,t.interactions.annotate.flag=!1,t.svg.style.cursor="move",document.getElementById("logfile").innerHTML+="Click "+t.svg.id+" "+(.4==+i.style.opacity?"disable":"enable")+" pan <br/>")})),r.addEventListener("click",(function(e){"hidden"!==t.svg.parentNode.style.visibility&&(r.style.opacity=.4==+r.style.opacity?1:.4,i.style.opacity=.4,s.style.opacity=.4,t.interactions.annotate.flag=!1,t.interactions.pan.flag=!1,t.interactions.brush.flag=!t.interactions.brush.flag,t.svg.style.cursor="crosshair",document.getElementById("logfile").innerHTML+="Click "+t.svg.id+" "+(.4==+r.style.opacity?"disable":"enable")+" brush <br/>")})),a.addEventListener("click",(function(e){if("hidden"!==t.svg.parentNode.style.visibility){t.interactions.filter.active=!t.interactions.filter.active;for(const e of t.svg_marks)e.style.visibility=t.interactions.filter.active?1==+e.getAttribute("opacity")?"visible":"hidden":"visible";document.getElementById("logfile").innerHTML+="Click "+t.svg.id+" "+(t.interactions.filter.active?"enable":"disable")+" filter <br/>"}})),s.addEventListener("click",(function(e){"hidden"!==t.svg.parentNode.style.visibility&&(s.style.opacity=.4==+s.style.opacity?1:.4,i.style.opacity=.4,r.style.opacity=.4,t.interactions.brush.flag=!1,t.interactions.pan.flag=!1,t.interactions.annotate.flag=!t.interactions.annotate.flag,t.svg.style.cursor="pointer",document.getElementById("logfile").innerHTML+="Click "+t.svg.id+" "+(.4==+s.style.opacity?"disable":"enable")+" annotate <br/>")}))},o.infer_mark_attributes=function(){for(const n of t.svg_marks)if("path"!==n.nodeName||!t.x_axis.ticks.length&&!t.y_axis.ticks.length||"path"===n.nodeName&&"ellipse"===n.type){if(n.__data__){if("string"==typeof n.__data__){var e=n.__data__;break}let t="datum"in n.__data__,i="properties"in n.__data__,r="data"in n.__data__;e=t?n.__data__.datum:i?n.__data__.properties:r?n.__data__.data:n.__data__}else{let i=(n.getBoundingClientRect().left+n.getBoundingClientRect().right)/2-o.state().x_axis.ticks[0].ticks[0].parentNode._global_transform[0]-o.state().svg.getBoundingClientRect().left,r=(n.getBoundingClientRect().top+n.getBoundingClientRect().bottom)/2-o.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1]-o.state().svg.getBoundingClientRect().top;e={[t.titles.x.innerHTML]:t.x_axis.scale.invert(i).toFixed(2),[t.titles.y.innerHTML]:t.y_axis.scale.invert(r).toFixed(2)}}n.style["pointer-events"]="fill",n.__inferred__data__=e}return o},o.state=function(){return t},o.updateBrush=function(){Qn.updateBrush(o)},o.disambiguate=function(t,e=!1){},o.filter=function(e,n,i,r){document.getElementById("filter_mode").style.opacity=1,document.getElementById("filter_mode").style.display="block";for(const h of t.svg_marks){if(("line"===h.type||"polygon"===h.type)&&t.x_axis.ticks.length&&t.y_axis.ticks.length)return t.interactions.brush.active=!0,void Qn.applyBrush(o,e,n,i,r);if(t.x_axis.ordinal.length||!t.x_axis.ticks.length&&!t.y_axis.ticks.length){var a=e,s=e+ +i,l=n+ +r,u=n;let t=h.getBoundingClientRect();var c=(+t.left+ +t.right)/2,f=(+t.top+ +t.bottom)/2}else{a=t.x_axis.scale.invert(e),s=t.x_axis.scale.invert(e+ +i),l=t.y_axis.scale.invert(n),u=t.y_axis.scale.invert(n+ +r);let o=h.getBoundingClientRect();c=(t.x_axis.scale.invert(+o.left)+t.x_axis.scale.invert(+o.right))/2,f=(t.y_axis.scale.invert(+o.top)+t.y_axis.scale.invert(+o.bottom))/2}c<a||c>s||f<u||f>l?h.setAttribute("opacity",.25):h.setAttribute("opacity",1)}},o.unfilter=function(){t.interactions.brush.active=!1,document.getElementById("filter_mode").style.display="none";for(const e of t.svg_marks)e.setAttribute("opacity",1)},o.analyze_axes=function(){return n(t.x_axis,"left"),n(t.y_axis,"top"),function(){for(let e=0;e<t.axis_text_marks.length;++e){let n=(+t.axis_text_marks[e].getBoundingClientRect().left+ +t.axis_text_marks[e].getBoundingClientRect().right)/2,i=(+t.axis_text_marks[e].getBoundingClientRect().top+ +t.axis_text_marks[e].getBoundingClientRect().bottom)/2,r=0,a=0;for(let e=0;e<t.x_axis.ticks.length;++e)Math.abs(n-t.x_axis.ticks[e].offset)<Math.abs(n-t.x_axis.ticks[r].offset)&&(r=e);for(let e=0;e<t.y_axis.ticks.length;++e)Math.abs(i-t.y_axis.ticks[e].offset)<Math.abs(i-t.y_axis.ticks[a].offset)&&(a=e);Math.abs(n-t.x_axis.ticks[r].offset)<Math.abs(i-t.y_axis.ticks[a].offset)?t.x_axis.ticks[r].label=t.axis_text_marks[e]:t.y_axis.ticks[a].label=t.axis_text_marks[e],t.axis_text_marks[e].setAttribute("class","tick")}}(),function(){if("hexchart"===t.svg.id)return;let e,n,i=1e4,r=0;for(const a of t.text_marks)a.getBoundingClientRect().left<i&&(i=a.getBoundingClientRect().left,n=a),a.getBoundingClientRect().bottom>r&&(r=a.getBoundingClientRect().bottom,e=a);n&&Math.abs(i-t.svg.getBoundingClientRect().left)<50&&(n.__title__=!0,t.titles.y=n),e&&Math.abs(r-t.svg.getBoundingClientRect().bottom)<50&&(e.__title__=!0,t.titles.x=e);for(const e of t.text_marks){if(e.__title__)continue;let n,i=(+e.getBoundingClientRect().left+ +e.getBoundingClientRect().right)/2,r=(+e.getBoundingClientRect().top+ +e.getBoundingClientRect().bottom)/2,a=1e4;for(const e of t.svg_marks){let t=(+e.getBoundingClientRect().left+ +e.getBoundingClientRect().right/2)/2,o=(+e.getBoundingClientRect().top+ +e.getBoundingClientRect().bottom)/2,s=Math.abs(t-i)+Math.abs(o-r);s<a&&(a=s,n=e)}n.removeAttribute("__mark__"),e.setAttribute("__legend__",!0),n.setAttribute("__legend__","true"),t.legend.push({label:e,glyph:n})}}(),o},o.infer_view=function(){a(t.x_axis),a(t.y_axis);const e=+t.svg.getAttribute("width"),n=+t.svg.getAttribute("height");if(!t.x_axis.ticks.length&&!t.y_axis.ticks.length)return t.x_axis.range=t.x_axis.global_range=[0,e],t.y_axis.range=t.y_axis.global_range=[n,0],o;if(t.has_domain){let e=[].slice.call(t.svg.querySelectorAll(".domain")).map((t=>t.getBoundingClientRect())),n=e[0].width<e[1].width?e[0]:e[1],a=e[0].height<e[1].height?e[0]:e[1];var i=a.left-t.svg.getBoundingClientRect().left,r=a.right-t.svg.getBoundingClientRect().left,s=n.bottom-t.svg.getBoundingClientRect().top,l=n.top-t.svg.getBoundingClientRect().top}else{let n=t.y_axis.ticks[0].ticks[0].getBoundingClientRect(),a=t.x_axis.ticks[0].ticks[0].getBoundingClientRect();if(n.right<a.left)i=n.right-t.svg.getBoundingClientRect().left,r=e;else i=n.left-t.svg.getBoundingClientRect().left,r=d3.min([n.width+i,e]);if(a.top>n.bottom)s=a.top-t.svg.getBoundingClientRect().top,l=0;else s=a.bottom-t.svg.getBoundingClientRect().top,l=d3.max([s-a.height,0])}t.x_axis.global_range=[i,r],t.y_axis.global_range=[s,l],t.x_axis.range=[i,r].map((e=>e-t.x_axis.ticks[0].ticks[0].parentNode._global_transform[0])),t.y_axis.range=[s,l].map((e=>e-t.y_axis.ticks[0].ticks[0].parentNode._global_transform[1]));let u=+t.y_axis.ticks[1].label.innerHTML-+t.y_axis.ticks[0].label.innerHTML,c=+t.y_axis.ticks[2].label.innerHTML-+t.y_axis.ticks[1].label.innerHTML,f=+t.x_axis.ticks[1].label.innerHTML-+t.x_axis.ticks[0].label.innerHTML,h=+t.x_axis.ticks[2].label.innerHTML-+t.x_axis.ticks[1].label.innerHTML,g=t.x_axis.ticks[1].ticks[0].getBoundingClientRect().left-t.x_axis.ticks[0].ticks[0].getBoundingClientRect().left,d=t.x_axis.ticks[2].ticks[0].getBoundingClientRect().left-t.x_axis.ticks[1].ticks[0].getBoundingClientRect().left;if(Math.abs(f-h)>.5||Math.abs(g-d)>.5){if(Math.abs(g-d)<.5){let e=t.x_axis.ticks.ticks[0].childNodes[1].innerHTML;if(e!=t.x_axis.ticks[0].__data__&&"string"==typeof e){var p=e.match(/^(e|\d+)\^(e|\d+)$/),_=e.match(/^(e|d+)([\u2070-\u209F\u00B2\u00B3\u00B9])$/);if(p)m="e"===(m=p[1])?Math.E:parseInt(m);else if(_){var m;m="e"===(m=_[1])?Math.E:parseInt(m)}}}function e(t){let e=Math.log(t)/Math.log(m);return _?"e"+String(e).replace(/\d/g,(function(t){return"⁰¹²³⁴⁵⁶⁷⁸⁹"[t]})):t+"^"+e}t.x_axis.scale=d3.scaleLog().domain(t.x_axis.domain).range(t.x_axis.range),t.x_axis.axis=ii(t.x_axis.scale,o).ticks(t.x_axis.ticks.filter((t=>t.label.innerHTML)).length),m&&(t.x_axis.scale=t.x_axis.scale.base(m),t.x_axis.axis=t.x_axis.axis.tickFormat((t=>p||_?e(t):t)))}else t.x_axis.scale=(t.x_axis.domain[0]instanceof Date?d3.scaleTime():t.x_axis.ordinal.length?d3.scaleBand():d3.scaleLinear()).domain(t.x_axis.ordinal.length?t.x_axis.ordinal:t.x_axis.domain).range(t.x_axis.range),t.x_axis.axis=ii(t.x_axis.scale,o).ticks(t.x_axis.ticks.length);return Math.abs(u-c)>.5?(t.y_axis.scale=d3.scaleLog().domain(t.y_axis.domain).range(t.y_axis.range),t.y_axis.axis=d3.axisLeft(t.y_axis.scale).tickSize(-t.y_axis.ticks[1].children[0].getAttribute("x2")).ticks(t.y_axis.ticks.length)):(t.y_axis.scale=(t.y_axis.domain[0]instanceof Date?d3.scaleTime():t.y_axis.ordinal.length?d3.scaleBand():d3.scaleLinear()).domain(t.y_axis.ordinal.length?t.y_axis.ordinal:t.y_axis.domain).range(t.y_axis.range),t.y_axis.axis=function(t,e){return ni(4,t,e)}(t.y_axis.scale,o).ticks(t.y_axis.ticks.length).tickFormat((e=>{let n=t.y_axis.ticks[0].label.innerHTML;return n.includes("M")||n.includes("k")?d3.format(".2s")(e):d3.format(",")(e)}))),function(){if(o.state().x_axis.scale&&!o.state().x_axis.ordinal.length){let t=o.state().x_axis.ticks[0].ticks[0],e=o.state().x_axis.ticks[o.state().x_axis.ticks.length-1].ticks[0];t=+(t.hasAttribute("transform")?t.getAttribute("transform").match(/(-?\d+\.?-?\d*)/g)[0]:t._global_transform[0]-o.state().x_axis.global_range[0]),e=+(e.hasAttribute("transform")?e.getAttribute("transform").match(/(-?\d+\.?-?\d*)/g)[0]:e._global_transform[0]-o.state().x_axis.global_range[0]);let n=o.state().x_axis.range.map(o.state().x_axis.scale.copy().range([t,e]).invert,o.state().x_axis.scale);o.state().x_axis.scale.domain(n)}if(o.state().y_axis.scale&&!o.state().y_axis.ordinal.length){let t=o.state().y_axis.ticks[0].ticks[0],e=o.state().y_axis.ticks[o.state().y_axis.ticks.length-1].ticks[0];t=+(t.hasAttribute("transform")?t.getAttribute("transform").match(/(-?\d+\.?-?\d*)/g)[1]:t._global_transform[1]-o.state().y_axis.global_range[1]),e=+(e.hasAttribute("transform")?e.getAttribute("transform").match(/(-?\d+\.?-?\d*)/g)[1]:e._global_transform[1]-o.state().y_axis.global_range[1]);let n=o.state().y_axis.range.map(o.state().y_axis.scale.copy().range([e,t]).invert,o.state().y_axis.scale);o.state().y_axis.scale.domain(n)}}(),o},o}function si(t){let e=Ln.parseSVG(t.getAttribute("d"));if(!e.length)return;t.contour=e;let n=e[e.length-1];3===e.length&&"A"===e[1].code&&"A"===n.code?t.type="ellipse":"Z"!==n.code?t.type="line":t.type="polygon"}function li(t,e,i){if(t._global_transform=[...i],t.nodeName===n.SVG_GROUP){let e=t.getAttribute("transform");e&&(i[0]+=+e.match(/(\d+\.?\d*)/g)[0],i[1]+=+e.match(/(\d+\.?\d*)/g)[1])}else if("text"===t.nodeName)e.state().axis_text_marks.push(t),t.style["pointer-events"]="none",t.style["user-select"]="none";else for(const i of n.SVG_MARK)if(t.nodeName===i){let n=t.hasAttribute("x2")?+t.getAttribute("x2"):0,i=t.hasAttribute("y2")?+t.getAttribute("y2"):0;n&&e.state().y_axis.ticks.push(t),i&&e.state().x_axis.ticks.push(t)}for(const n of t.childNodes)li(n,e,[...i])}function ui(t,e,i){if(null!==t){var r=!1;if(t._global_transform=[...i],t.nodeName===n.SVG_CONTAINER&&(e.state().svg=t),t.nodeName===n.SVG_GROUP){let n=t.getAttribute("transform");n&&(i[0]+=+n.match(/(\d+\.?\d*)/g)[0],i[1]+=+n.match(/(\d+\.?\d*)/g)[1]);let a=t.className.animVal;if(a.includes("legend"))r=!0;else if(a.includes("tick")||a.includes("grid")||a.includes("label")){r=!0;for(const n of t.childNodes)li(n,e,[...i])}}else{let i=!1;for(const r of n.SVG_MARK){if("text"===t.nodeName&&(t.style["pointer-events"]="none",t.style["user-select"]="none",i||(e.state().text_marks.push(t),i=!0)),t.className&&("background"===t.className.animVal||"foreground"===t.className.animVal))break;if(t.nodeName===r){"path"===r&&si(t),t.className&&t.className.animVal===n.TICK_DOMAIN?e.state().has_domain=!0:(t.setAttribute("__mark__","true"),t.__transform=t.hasAttribute("transform")?t.getAttribute("transform"):"translate(0, 0)",e.state().svg_marks.push(t));break}}}if(!r)for(const n of t.childNodes)ui(n,e,[...i])}}function ci(t){let e=new oi;return ui(t,e,[0,0]),e.analyze_axes().infer_view().infer_mark_attributes(),console.log(e.state()),e}t.hydrate=function(t,e){let n=document.querySelector(t);if(!n)return;document.querySelector(e),function(t,e){for(const[t,n]of Object.entries(e.state().interactions)){n.control=document.querySelector("#"+t);const e=document.querySelector("#"+t+"_axis");e&&(n.axis_control=e)}return e}(0,ci(n)).hydrate()},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=automatic-interaction.min.js.map
