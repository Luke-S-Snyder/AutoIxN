<html>
    <head>
        <title>Automatic Interaction</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="event_handler.js"></script>
        <script src="constants.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="myParser.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega@5.21.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.2"></script>
        <link rel="stylesheet" href="../style/style.css">
        <link rel="stylesheet" href="../style/prism.css">
        <link rel="stylesheet" href="../style/agency.css">
    </head>
    <body>
        <div id="tooltip"></div>
        <div style="position:relative;">
            <div id="scatter_plot"></div>
            <div id="controls" style="position:relative">
                <label for="inputs">Click and drag:</label>
                <select name="inputs" id="inputs">
                    <option value="pan">Pan</option>
                    <option value="zoom">Zoom</option>
                    <option value="brush">Brush</option>
                </select>
            </div>
        </div>
        <div>
            <pre class="language-js">
                <code id="js-brushChange" contenteditable="true" class=" language-js">
                </code>
            </pre>
        </div>
        <script>
            event_handler = new EventHandler();
            let update_event_handler = function() {
                event_handler.clear_svg();
                event_handler.walk_svg(document.body);
                event_handler.bind_interactions();
                // event_handler.print_svg_information();
            };

            let editable = document.getElementById("js-brushChange");
            let that = this;
            
            $("#js-brushChange").load("../visualizations/scatter_plot.js", function() {
                that.eval(editable.innerText).then(function() {
                    update_event_handler();
                });
            });

            editable.addEventListener('input', function() {
                document.getElementById("scatter_plot").innerText = "";
                that.eval(myJSParser("js-brushChange", "scatter_plot")).then(function() {
                    update_event_handler();
                });
            });
        </script>
    </body>
</html>
