<html>
    <head>
        <title>Automatic Interaction</title>
        <script src="./dist/automatic-interaction.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
        <script src="examples/visualizations/scatter_plot_2.js"></script>
        <script src="examples/visualizations/line_chart.js"></script>
        <script src="examples/visualizations/stacked_chart.js"></script> 
        <script src="examples/visualizations/vega_chart.js"></script> 
        <script src="examples/visualizations/bar_chart_2.js"></script>
        <script src="examples/visualizations/log_chart.js"></script> 
        <script src="examples/visualizations/hex.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    </head>

    <body>     
        <div>
            <div style= "position:absolute;display:flex;margin-top:20px;margin-left:20px;">
                <div id="vis"></div> 
                <div id="linevis" style="position:absolute;visibility:hidden;"></div> 
                <div id="stackedvis" style="position:absolute;visibility:hidden;"></div>
                <div id="vega" style="position:absolute;visibility:hidden;"></div>
                <div id="barchart" style="position:absolute;visibility:hidden;"></div>
                <div id="log" style="position:absolute;visibility:hidden;"></div>
                <div id="hex" style="position:absolute;visibility:hidden;"></div>

                <div id="control" style="margin-left:30px;">
                    <div style="display:none;">
                    <div class="form-check form-switch" style="margin-bottom:15px;">
                        <input type="checkbox" value="Annotate" id="annotate" class="form-check-input"/>Annotate
                    </div>

                    <div class="form-check form-switch" style="margin-bottom:15px;">
                        <input type="checkbox" value="Selection" id="selection" class="form-check-input" checked/>Selection
                    </div>

                    <div style="margin-bottom:15px;">
                        <div class="form-check form-switch form-check-inline">
                            <input type="checkbox" value="Zoom" id="zoom" class="form-check-input with-options" checked/>Zoom
                        </div>
                        <div class="btn-group dropend">
                            <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                Options
                            </button>
                            <ul class="dropdown-menu">
                                <a id="zoom-2d" class="dropdown-item bg-primary text-white axis">2D</a>
                                <a id="zoom-x" class="dropdown-item axis">X axis</a>
                                <a id="zoom-y" class="dropdown-item axis">Y axis</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item bg-primary text-white input scroll">Mouse scroll</a>
                                <a class="dropdown-item bg-primary text-white input dbclick">Double click</a>
                                <a class="dropdown-item input drag">Click and drag</a>
                                <a class="dropdown-item input shift">Shift / cmd + click and drag</a>
                            </ul>
                        </div>
                    </div>

                    <div style="margin-bottom:15px;">
                        <div class="form-check form-switch form-check-inline">
                            <input type="checkbox" value="Pan" id="pan" class="form-check-input with-options" checked/>Pan
                        </div>
                        <div style="margin-left:15px;" class="btn-group dropend">
                            <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                Options
                            </button>
                            <ul class="dropdown-menu">
                                <a id="pan-2d" class="dropdown-item bg-primary text-white axis">2D</a>
                                <a id="pan-x" class="dropdown-item axis">X axis</a>
                                <a id="pan-y" class="dropdown-item axis">Y axis</a>
                                <div class="dropdown-divider"></div>
                                <a id="pan-drag" class="dropdown-item bg-primary text-white input drag">Click and drag</a>
                                <a id="pan-shift" class="dropdown-item input shift">Shift / cmd + click and drag</a>
                            </ul>
                        </div>
                    </div>

                    <div style="margin-bottom:15px;">
                        <div class="form-check form-switch form-check-inline">
                            <input type="checkbox" value="Brush" id="brush" class="form-check-input with-options" checked/>Brush
                        </div>
                        <div class="btn-group dropend">
                            <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                Options
                            </button>
                            <ul class="dropdown-menu brush">
                                <a class="dropdown-item bg-primary text-white axis">2D</a>
                                <a class="dropdown-item axis">X axis</a>
                                <a class="dropdown-item axis">Y axis</a>
                                <div class="dropdown-divider"></div>
                                <a id="brush-drag" class="dropdown-item input drag">Click and drag</a>
                                <a id="brush-shift" class="dropdown-item bg-primary text-white input shift">Shift / cmd + click and drag</a>
                            </ul>
                        </div>
                    </div>

                    <div style="margin-bottom:15px;">
                        <div class="form-check form-switch form-check-inline">
                            <input type="checkbox" id="filter" class="form-check-input"/> Filter
                        </div>
                        <div style="margin-left:6px;" class="btn-group dropend">
                            <!-- <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown" disabled>
                                Options
                            </button> -->
                            <select disabled id="field" class="form-select" aria-label="Default select example">
                            </select>
                            <div class="col-sm-2" style="margin-right:5px;">
                                <select disabled id="condition" style="margin-left:5px;" class="form-select" aria-label="Default select example">
                                </select>
                            </div>
                            <div class="col-sm-5" style="margin-left:5px;">
                                <input disabled id="condition-text" placeholder="Value" class="form-control" id="exampleFormControlTextarea1" rows="1" type="text"></input>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="form-check form-switch form-check-inline">
                            <input type="checkbox" id="sort" class="form-check-input"/> Sort
                        </div>
                        <div style="margin-left:11px;" class="btn-group dropend">
                            <!-- <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown" disabled>
                                Options
                            </button>
                            <ul class="dropdown-menu">
                                <div class="dropdown-divider"></div>
                            </ul> -->
                        </div>
                    </div>

                    <br/>
                    </div>

                    <div>
                        <button id="left" type="button" class="btn btn-secondary btn-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                                <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
                            </svg>
                        </button>
                        <button id="right" type="button" class="btn btn-secondary btn-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                                <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                            </svg>
                        </button>
                    </div>

                    <br />

                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                        </symbol>
                      </svg>

                    <div class="alert alert-primary" role="alert" id="pan_disam" style="display:none">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Info:"><use xlink:href="#info-fill"/></svg>
                        Are you attempting to pan?
                        <button type="button" class="btn btn-primary" style="margin-left:10px;" id="pan-btn">Yes</button>
                    </div>
                    <!-- <div class="alert alert-primary" role="alert" id="zoom_disam" style="display:none">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Info:"><use xlink:href="#info-fill"/></svg>
                        Are you attempting to zoom with brush?
                        <button type="button" class="btn btn-primary" style="margin-left:10px;">Yes</button>
                    </div> -->
                    <div class="alert alert-primary" role="alert" id="brush_disam" style="display:none">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Info:"><use xlink:href="#info-fill"/></svg>
                        Are you attempting to brush?
                        <button type="button" class="btn btn-primary" style="margin-left:10px;" id="brush-btn">Yes</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            var pos = 0;
            var chart_ids = ['vis', 'linevis', 'stackedvis', 'vega', 'barchart', 'log', 'hex'];

            // $('.dropdown-menu a').on('click', function (e) {
            //     $(this).toggleClass("bg-primary");
            //     $(this).toggleClass("text-white");
            //     e.stopPropagation();
            // });

            function constrain(classname) {
                $('.dropdown-menu').each(function(d) {
                    let that = this;
                    if (!$(that).find('.input.bg-primary').length) {
                        let checkbox = $(that).parent().parent().find('.form-check-input');
                        $(checkbox).prop('checked', false);
                        $(that).parent().find('.dropdown-toggle').prop('disabled', true);
                    }
                });
            }

            createScatterPlot();
            createLineChart(); 
            createStackedChart();
            createVegaLineChart();
            createBarChart();
            createLogChart();
            createHexChart();

            $("#right").on("click", function(event) {
                $("#" + chart_ids[pos]).css("visibility", "hidden");
                pos = (pos + 1) % chart_ids.length;
                $("#" + chart_ids[pos]).css("visibility", "visible");
            });
            $("#left").on("click", function(event) {
                $("#" + chart_ids[pos]).css("visibility", "hidden");
                pos = (pos - 1 + chart_ids.length) % chart_ids.length;
                $("#" + chart_ids[pos]).css("visibility", "visible");
            });

            // Input disambiguation.
            $('.axis').on('click', function(event) {
                let that = this;
                $(this).toggleClass("bg-primary");
                $(this).toggleClass("text-white");

                if (!$(this).parent().find(".axis.bg-primary").length) {
                    $(this).toggleClass("bg-primary");
                    $(this).toggleClass("text-white");

                    event.stopPropagation();
                    return;
                }

                $(this).parent().find(".axis").each(function(d) {
                    if (this === that) return;

                    $(this).toggleClass("bg-primary", false);
                    $(this).toggleClass("text-white", false);
                });

                event.stopPropagation();
            });

            $('.scroll').on('click', function(event) {
                $(this).toggleClass("bg-primary");
                $(this).toggleClass("text-white");

                if (!$(this).parent().find(".input.bg-primary").length) {
                    $(this).toggleClass("bg-primary");
                    $(this).toggleClass("text-white");

                    event.stopPropagation();
                    return;
                }

                constrain();
                event.stopPropagation();
            });

            $('.dbclick').on('click', function(event) {
                $(this).toggleClass("bg-primary");
                $(this).toggleClass("text-white");

                if (!$(this).parent().find(".input.bg-primary").length) {
                    $(this).toggleClass("bg-primary");
                    $(this).toggleClass("text-white");

                    event.stopPropagation();
                    return;
                }

                constrain();
                event.stopPropagation();
            });

            $('.shift').on('click', function(event) {
                let that = this;
                $(this).toggleClass("bg-primary");
                $(this).toggleClass("text-white");

                if (!$(this).parent().find(".input.bg-primary").length) {
                    $(this).toggleClass("bg-primary");
                    $(this).toggleClass("text-white");

                    event.stopPropagation();
                    return;
                }

                $('.shift').each(function(d) {
                    if (this === that) return;

                    $(this).toggleClass("bg-primary", false);
                    $(this).toggleClass("text-white", false);
                });

                constrain();
                event.stopPropagation();
            });

            $('.drag').on('click', function(event) {
                let that = this;
                $(this).toggleClass("bg-primary");
                $(this).toggleClass("text-white");

                if (!$(this).parent().find(".input.bg-primary").length) {
                    $(this).toggleClass("bg-primary");
                    $(this).toggleClass("text-white");

                    event.stopPropagation();
                    return;
                }

                $('.drag').each(function(d) {
                    if (this === that) return;

                    $(this).toggleClass("bg-primary", false);
                    $(this).toggleClass("text-white", false);
                });

                constrain();
                event.stopPropagation();
            });

            $('#filter').on('click', function(event) {
                let parent = $(this).parent().parent();
                $(parent).find('.form-control, .form-select').prop('disabled', function(i, d) { return !d });
            });

            $('.form-check-input.with-options').on('click', function(event) {
                let parent = $(this).parent().parent();
                if (this.checked) {
                    if (!parent.find('.input.bg-primary').length) {
                        let elem = parent.find('.input').first();
                        let input_class = elem.hasClass('scroll') ? '.scroll' :
                            elem.hasClass('dbclick') ? '.dbclick' :
                            elem.hasClass('drag') ? '.drag' :
                            '.shift';

                        $(input_class).toggleClass('bg-primary', false);
                        $(input_class).toggleClass('text-white', false);

                        elem.toggleClass('bg-primary');
                        elem.toggleClass('text-white');
                    }
                }
                $(parent).find('.dropdown-toggle').prop('disabled', function(i, d) { return !d });
                constrain();
            });
        </script>
    </body>
</html>
